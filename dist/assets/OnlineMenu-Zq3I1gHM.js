import{m as Be,r as l,j as e,a0 as bt,a1 as rs,X as I,Z as wt,s as c,U as Je,a2 as ge,p as be,W as K,a3 as fe,J as ns,a4 as kt,Y as ve,a5 as He,a6 as Ae,q as ls,u as is,a7 as gt,N as os,a as cs,y as Xe,a8 as ft,a9 as ds,aa as ms,z as xs,K as us,T as Ye,ab as hs,A as vt,L as yt,ac as ps,ad as bs,ae as gs}from"./index-8HZmLUul.js";import{g as U}from"./gameSync-C85scV0-.js";import{inviteService as j}from"./inviteService-DhtWqPFk.js";import{n as C,r as Fe,S as fs}from"./rematchService-B9FdZ2Mv.js";import{f as G,U as Ze,L as vs,V as ys,F as js}from"./ViewPlayerProfile-Ds208_10.js";import{s as Ns,S as ws}from"./SpectatorView-WDgcaXPl.js";import{A as ks}from"./alert-triangle-CdR1lECF.js";import{C as ye}from"./clock-DH6CZMwC.js";import{S as $e}from"./search-2i7mNli-.js";import{S as Ss}from"./share-2-R-aqbu5s.js";import"./skip-forward-CzNewA36.js";import"./play-CKcjBX8x.js";import"./trending-up-D4E_By2q.js";import"./calendar-UBey0MGi.js";const Cs=Be("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),jt=Be("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Nt=Be("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),_s=Be("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Is=({onDismiss:m})=>{const[g,T]=l.useState(!1),[h,u]=l.useState(null),[f,p]=l.useState(!1);l.useEffect(()=>{const x=setTimeout(()=>p(!0),100);return()=>clearTimeout(x)},[]);const R=async()=>{T(!0),c.playClickSound?.("click");const x=await C.requestPermission();u(x),T(!1),x==="granted"&&c.playClickSound?.("success"),setTimeout(()=>{p(!1),setTimeout(()=>m?.(),300)},x==="granted"?1500:2500)},s=()=>{c.playClickSound?.("click"),C.dismissPrompt(),p(!1),setTimeout(()=>m?.(),300)},N=()=>{c.playClickSound?.("click");try{localStorage.setItem("deadblock_notification_prompt_dismissed","true")}catch{}p(!1),setTimeout(()=>m?.(),300)};return h==="granted"?e.jsx("div",{className:`fixed bottom-5 left-5 right-5 max-w-sm mx-auto z-[9999] transition-all duration-300 ${f?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsxs("div",{className:"relative p-4 rounded-xl border-2 border-green-400/60 overflow-hidden",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%)",boxShadow:"0 0 30px rgba(16, 185, 129, 0.5), 0 0 60px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(255,255,255,0.2)"},children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-green-300 to-transparent animate-shimmer"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:"rgba(255, 255, 255, 0.2)",boxShadow:"0 0 20px rgba(134, 239, 172, 0.5)"},children:e.jsx(bt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-bold text-base",style:{fontFamily:"'Orbitron', sans-serif"},children:"NOTIFICATIONS ENABLED"}),e.jsx("p",{className:"text-green-100 text-sm mt-0.5",children:"You'll be notified when it's your turn"})]})]})]})}):h==="denied"?e.jsx("div",{className:`fixed bottom-5 left-5 right-5 max-w-sm mx-auto z-[9999] transition-all duration-300 ${f?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsx("div",{className:"relative p-4 rounded-xl border-2 border-red-500/60 overflow-hidden",style:{background:"linear-gradient(135deg, rgba(127, 29, 29, 0.95) 0%, rgba(153, 27, 27, 0.95) 100%)",boxShadow:"0 0 30px rgba(239, 68, 68, 0.4)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{background:"rgba(255, 255, 255, 0.1)"},children:e.jsx(rs,{className:"w-6 h-6 text-red-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-bold text-base",style:{fontFamily:"'Orbitron', sans-serif"},children:"NOTIFICATIONS BLOCKED"}),e.jsx("p",{className:"text-red-200 text-sm mt-0.5",children:"Enable in browser settings to receive alerts"})]})]})})}):e.jsxs("div",{className:`fixed bottom-5 left-5 right-5 max-w-sm mx-auto z-[9999] transition-all duration-300 ${f?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsxs("div",{className:"relative p-4 rounded-xl border-2 overflow-hidden",style:{background:"linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%)",borderColor:"rgba(34, 211, 238, 0.5)",boxShadow:"0 0 30px rgba(34, 211, 238, 0.3), 0 0 60px rgba(168, 85, 247, 0.2), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px]",style:{background:"linear-gradient(90deg, transparent, rgba(34, 211, 238, 0.8), rgba(168, 85, 247, 0.8), transparent)",animation:"shimmer 2s ease-in-out infinite"}}),e.jsx("div",{className:"absolute top-0 left-0 w-3 h-3 border-t-2 border-l-2 border-cyan-400/80"}),e.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 border-t-2 border-r-2 border-purple-400/80"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-3 h-3 border-b-2 border-l-2 border-purple-400/80"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 border-b-2 border-r-2 border-cyan-400/80"}),e.jsx("button",{onClick:s,className:"absolute top-2 right-2 p-1.5 text-slate-500 hover:text-cyan-400 transition-colors rounded-lg hover:bg-slate-800/50",children:e.jsx(I,{size:18})}),e.jsxs("div",{className:"flex items-start gap-3 pr-6",children:[e.jsxs("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 relative",style:{background:"linear-gradient(135deg, rgba(34, 211, 238, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%)",boxShadow:"0 0 20px rgba(34, 211, 238, 0.3)"},children:[e.jsx(bt,{className:"w-6 h-6 text-cyan-400"}),e.jsx("div",{className:"absolute inset-0 rounded-xl bg-cyan-400/20 animate-ping",style:{animationDuration:"2s"}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wt,{size:14,className:"text-cyan-400"}),e.jsx("h3",{className:"text-cyan-300 font-bold text-sm uppercase tracking-wider",style:{fontFamily:"'Orbitron', sans-serif"},children:"Enable Notifications"})]}),e.jsx("p",{className:"text-slate-400 text-sm mt-1 leading-relaxed",children:"Get notified when it's your turn or when you receive a challenge"}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsxs("button",{onClick:R,disabled:g,className:"flex-1 py-2.5 px-4 rounded-lg font-bold text-sm uppercase tracking-wider transition-all disabled:opacity-50 relative overflow-hidden group",style:{background:"linear-gradient(135deg, rgba(34, 211, 238, 0.9) 0%, rgba(56, 189, 248, 0.9) 100%)",boxShadow:"0 0 20px rgba(34, 211, 238, 0.4)",fontFamily:"'Orbitron', sans-serif",color:"#0f172a"},children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("span",{className:"relative",children:g?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-900/30 border-t-slate-900 rounded-full animate-spin"}),"Enabling..."]}):"Enable"})]}),e.jsx("button",{onClick:s,className:"py-2.5 px-4 text-slate-500 hover:text-cyan-400 transition-colors text-sm font-medium",children:"Later"})]}),e.jsx("button",{onClick:N,className:"mt-2 text-xs text-slate-600 hover:text-slate-400 transition-colors",children:"Already enabled? Dismiss forever"})]})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.03]",style:{background:"repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.5) 2px, rgba(255,255,255,0.5) 4px)"}})]}),e.jsx("style",{children:`
        @keyframes shimmer {
          0%, 100% {
            opacity: 0.5;
            transform: translateX(-100%);
          }
          50% {
            opacity: 1;
            transform: translateX(100%);
          }
        }
      `})]})},Ue=(m,g)=>{if(!m||!m.startsWith("#"))return`rgba(100, 116, 139, ${g})`;const T=parseInt(m.slice(1,3),16),h=parseInt(m.slice(3,5),16),u=parseInt(m.slice(5,7),16);return`rgba(${T}, ${h}, ${u}, ${g})`},Ts=({friend:m,games:g,onSpectate:T,onClose:h})=>!g||g.length===0?null:e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-sm w-full overflow-hidden border border-green-500/30 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"text-green-400",size:20}),e.jsxs("h3",{className:"font-bold text-green-300",children:["Watch ",m?.username,"'s Games"]})]}),e.jsx("button",{onClick:h,className:"text-slate-400 hover:text-white",children:e.jsx(I,{size:20})})]}),e.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",style:{WebkitOverflowScrolling:"touch"},children:e.jsx("div",{className:"space-y-3",children:g.map(u=>{const f=u.player1?.id===m.id?u.player2:u.player1,p=ge.getRatingTier(f?.rating||f?.elo_rating||1200);return e.jsx("button",{onClick:()=>{c.playButtonClick(),T(u.id)},className:"w-full p-3 bg-slate-800/60 rounded-lg border border-slate-700/50 hover:border-green-500/50 hover:bg-slate-800 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white text-xs font-bold",children:m.username?.[0]?.toUpperCase()||"?"}),e.jsx("span",{className:"text-slate-500 text-xs font-bold",children:"VS"}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{background:`linear-gradient(135deg, ${Ue(p.glowColor,.8)}, ${Ue(p.glowColor,.4)})`},children:f?.username?.[0]?.toUpperCase()||"?"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white text-sm font-medium",children:["vs ",f?.username||"Unknown"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(K,{shape:p.shape,glowColor:p.glowColor,size:"small"}),e.jsx("span",{children:f?.rating||f?.elo_rating||1200})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),e.jsx("span",{className:"text-green-400 text-xs font-medium group-hover:text-green-300",children:"Watch →"})]})]})},u.id)})})}),e.jsx("div",{className:"p-4 border-t border-slate-800",children:e.jsx("button",{onClick:h,className:"w-full py-2 bg-slate-800 text-slate-300 rounded-lg hover:bg-slate-700 transition-colors",children:"Cancel"})})]})}),Es=({userId:m,onInviteFriend:g,onSpectate:T,onViewProfile:h,onClose:u})=>{const[f,p]=l.useState("friends"),[R,s]=l.useState([]),[N,x]=l.useState([]),[v,q]=l.useState([]),[_,Qe]=l.useState(""),[Pe,L]=l.useState([]),[ie,O]=l.useState(!1),[Ge,je]=l.useState(!0),[oe,X]=l.useState([]),[Y,Ne]=l.useState(null),[ee,te]=l.useState(null),[W,Oe]=l.useState(new Set),[J,B]=l.useState(null),[ce,D]=l.useState([]);l.useEffect(()=>{S()},[m]);const S=async()=>{je(!0),Ne(null);try{const[r,d,E]=await Promise.all([G.getFriends(m),G.getPendingRequests(m),G.getSentRequests(m)]);if(r.error)throw new Error(r.error.message||"Failed to load friends");if(r.data&&s(r.data),d.data&&x(d.data),E.data&&q(E.data),r.data?.length>0){const z=r.data.map(ne=>ne.id),{data:w}=await Ns.getFriendGames(z);w&&X(w)}}catch(r){console.error("Error loading friends data:",r),Ne("Social features require database migration. Please run the migration first.")}je(!1)},se=async()=>{if(!(!_.trim()||_.length<2)){O(!0);try{const{data:r}=await j.searchUsers(_,m,10);if(r){const d=new Set(R.map(w=>w.id)),E=new Set([...N.map(w=>w.from?.id),...v.map(w=>w.to?.id)].filter(Boolean)),z=r.map(w=>({...w,isFriend:d.has(w.id),isPending:E.has(w.id)}));L(z)}}catch(r){console.error("Search error:",r)}O(!1)}},Z=async r=>{const{error:d}=await G.sendFriendRequest(m,r);d||(c.playSound("success"),S(),L(E=>E.map(z=>z.id===r?{...z,isPending:!0}:z)))},we=async r=>{const{error:d}=await G.acceptFriendRequest(r,m);d||(c.playSound("success"),S())},de=async r=>{const{error:d}=await G.declineFriendRequest(r,m);d||S()},ke=async r=>{if(!confirm("Remove this friend?"))return;const{error:d}=await G.removeFriend(r,m);d||S()},Se=async r=>{if(!(ee||W.has(r.id))){te(r.id);try{const{data:d,error:E}=await j.sendInvite(m,r.id);E||(c.playSound("success"),Oe(z=>new Set([...z,r.id])),g&&g(r))}catch(d){console.error("Error sending game invite:",d)}te(null)}},me=r=>oe.filter(d=>d.player1?.id===r||d.player2?.id===r),ae=r=>me(r).length,re=r=>{const d=me(r.id);d.length!==0&&(d.length===1?T?.(d[0].id):(c.playButtonClick(),B(r),D(d)))},Ce=r=>{B(null),D([]),T?.(r)},_e=r=>{const d=ae(r.id);return d>0?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{size:8,className:"fill-green-400 text-green-400"}),e.jsx("span",{className:"text-green-400 text-xs",children:d===1?"1 game":`${d} games`})]}):r.is_online?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{size:8,className:"fill-green-400 text-green-400"}),e.jsx("span",{className:"text-green-400 text-xs",children:"Online"})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{size:8,className:"fill-slate-600 text-slate-600"}),e.jsx("span",{className:"text-slate-500 text-xs",children:"Offline"})]})},P=r=>ge.getRatingTier(r||1200);return e.jsxs("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:[J&&ce.length>0&&e.jsx(Ts,{friend:J,games:ce,onSpectate:Ce,onClose:()=>{B(null),D([])}}),e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-md w-full max-h-[85vh] overflow-hidden border border-amber-500/30 shadow-xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-amber-500/20 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"text-amber-400",size:24}),e.jsx("h2",{className:"text-lg font-bold text-amber-300",children:"Friends"})]}),e.jsx("button",{onClick:u,className:"text-slate-400 hover:text-white",children:e.jsx(I,{size:24})})]}),e.jsxs("div",{className:"flex border-b border-amber-500/20 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>p("friends"),className:`flex-1 py-3 text-sm font-medium transition-colors ${f==="friends"?"bg-amber-500/20 text-amber-300 border-b-2 border-amber-400":"text-slate-400 hover:text-slate-200"}`,children:["Friends (",R.length,")"]}),e.jsxs("button",{onClick:()=>p("requests"),className:`flex-1 py-3 text-sm font-medium transition-colors relative ${f==="requests"?"bg-amber-500/20 text-amber-300 border-b-2 border-amber-400":"text-slate-400 hover:text-slate-200"}`,children:["Requests",N.length>0&&e.jsx("span",{className:"absolute top-2 right-4 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:N.length})]}),e.jsx("button",{onClick:()=>p("add"),className:`flex-1 py-3 text-sm font-medium transition-colors ${f==="add"?"bg-amber-500/20 text-amber-300 border-b-2 border-amber-400":"text-slate-400 hover:text-slate-200"}`,children:"Add"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",scrollbarWidth:"thin",scrollbarColor:"rgba(100, 116, 139, 0.4) transparent"},children:Ge?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-2 border-amber-400 border-t-transparent rounded-full animate-spin"})}):Y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ks,{className:"mx-auto text-amber-500 mb-3",size:40}),e.jsx("p",{className:"text-amber-300 mb-2 font-medium",children:"Feature Setup Required"}),e.jsx("p",{className:"text-slate-400 text-sm",children:Y})]}):f==="friends"?R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"mx-auto text-slate-600 mb-2",size:40}),e.jsx("p",{className:"text-slate-400",children:"No friends yet"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Add friends to challenge them to games!"}),e.jsx("button",{onClick:()=>p("add"),className:"mt-4 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400",children:"Find Friends"})]}):e.jsx("div",{className:"space-y-2",children:R.map(r=>{const d=P(r.rating||r.elo_rating),E=d.glowColor,z=W.has(r.id),w=ae(r.id);return e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700/50 hover:border-amber-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>h?.(r.id,r),className:"flex items-center gap-3 flex-1 text-left hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-bold overflow-hidden",children:r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:"",className:"w-full h-full object-cover"}):r.username?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-white truncate",children:r.username}),e.jsx(be,{size:14,className:"text-slate-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded",style:{background:Ue(E,.15),border:`1px solid ${Ue(E,.3)}`},children:[e.jsx(K,{shape:d.shape,glowColor:E,size:"small"}),e.jsx("span",{style:{color:E},className:"font-medium",children:r.rating||r.elo_rating||1200})]}),e.jsx("span",{className:"text-slate-600",children:"•"}),_e(r)]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[z?e.jsx("div",{className:"px-2 py-1 bg-slate-700 text-slate-400 rounded text-xs",children:"Invited"}):e.jsx("button",{onClick:()=>Se(r),disabled:ee===r.id,className:"p-2 rounded-lg transition-colors disabled:opacity-50 bg-amber-500/20 text-amber-400 hover:bg-amber-500/30",title:r.is_online?"Challenge to a game":"Send game invite (they'll see it when online)",children:ee===r.id?e.jsx("div",{className:"w-4 h-4 border-2 border-amber-400 border-t-transparent rounded-full animate-spin"}):e.jsx(fe,{size:18})}),e.jsx("button",{onClick:()=>ke(r.friendshipId),className:"p-2 bg-red-500/20 text-red-400 hover:bg-red-500/30 rounded-lg transition-colors",title:"Remove friend",children:e.jsx(_s,{size:18})})]})]}),w>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(ns,{size:12,className:"text-green-400"}),e.jsx("span",{children:w===1?"1 active game":`${w} active games`})]}),e.jsxs("button",{onClick:()=>re(r),className:"flex items-center gap-1 text-green-400 hover:text-green-300 font-medium px-2 py-1 bg-green-500/10 rounded hover:bg-green-500/20 transition-colors",children:[e.jsx(kt,{size:12}),"Watch"]})]})})]},r.friendshipId)})}):f==="requests"?e.jsxs("div",{className:"space-y-4",children:[N.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:"Received"}),e.jsx("div",{className:"space-y-2",children:N.map(r=>{const d=P(r.from?.elo_rating||r.from?.rating);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-amber-500/30",children:[e.jsxs("button",{onClick:()=>h?.(r.from?.id,r.from),className:"flex items-center gap-3 flex-1 text-left hover:opacity-80",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold",children:r.from?.username?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:r.from?.username}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(K,{shape:d.shape,glowColor:d.glowColor,size:"small"}),e.jsx("span",{className:d.color,children:r.from?.rating||1200})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>we(r.requestId),className:"p-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30",children:e.jsx(ve,{size:18})}),e.jsx("button",{onClick:()=>de(r.requestId),className:"p-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30",children:e.jsx(I,{size:18})})]})]},r.requestId)})})]}),v.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-400 mb-2",children:"Sent"}),e.jsx("div",{className:"space-y-2",children:v.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center text-slate-300 font-bold",children:r.to?.username?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:r.to?.username}),e.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ye,{size:12})," Pending"]})]})]}),e.jsx("button",{onClick:()=>de(r.requestId),className:"text-slate-500 hover:text-red-400",children:e.jsx(I,{size:18})})]},r.requestId))})]}),N.length===0&&v.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"mx-auto text-slate-600 mb-2",size:40}),e.jsx("p",{className:"text-slate-400",children:"No pending requests"})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:_,onChange:r=>Qe(r.target.value),onKeyDown:r=>r.key==="Enter"&&se(),placeholder:"Search by username...",className:"flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none"}),e.jsx("button",{onClick:se,disabled:ie||_.length<2,className:"px-4 py-2 bg-amber-500 text-slate-900 rounded-lg font-medium hover:bg-amber-400 disabled:opacity-50",children:ie?"...":e.jsx($e,{size:20})})]}),Pe.length>0?e.jsx("div",{className:"space-y-2",children:Pe.map(r=>{const d=P(r.rating||r.elo_rating);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("button",{onClick:()=>h?.(r.id,r),className:"flex items-center gap-3 flex-1 text-left hover:opacity-80",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center text-white font-bold",children:r.username?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:r.username}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(K,{shape:d.shape,glowColor:d.glowColor,size:"small"}),e.jsx("span",{className:d.color,children:r.rating||r.elo_rating||1200})]})]})]}),r.isFriend?e.jsx("span",{className:"text-green-400 text-sm",children:"Friends"}):r.isPending?e.jsx("span",{className:"text-amber-400 text-sm",children:"Pending"}):e.jsx("button",{onClick:()=>Z(r.id),className:"p-2 bg-amber-500/20 text-amber-400 rounded-lg hover:bg-amber-500/30",children:e.jsx(Ze,{size:18})})]},r.id)})}):_.length>=2&&!ie?e.jsx("div",{className:"text-center py-4 text-slate-400",children:"No users found"}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($e,{className:"mx-auto text-slate-600 mb-2",size:40}),e.jsx("p",{className:"text-slate-400",children:"Search for players to add"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Enter at least 2 characters"})]})]})})]})]})},zs=({userId:m,onAccept:g,onDecline:T})=>{const[h,u]=l.useState([]);l.useEffect(()=>{if(!m)return;console.log("[GameInviteNotification] Setting up subscriptions for:",m);const s=Ae.channel(`invite-notify-${m}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"game_invites",filter:`to_user_id=eq.${m}`},async x=>{console.log("[GameInviteNotification] New invite received:",x);const{data:v}=await Ae.from("game_invites").select(`
              *,
              from_user:profiles!game_invites_from_user_id_fkey(id, username, display_name)
            `).eq("id",x.new.id).single();if(v&&v.status==="pending"){const q=v.from_user?.display_name||v.from_user?.username||"Someone";u(_=>[..._,{id:v.id,type:"invite",sender:q,senderId:v.from_user_id,timestamp:Date.now()}]),c.playSound("notification"),document.hidden&&C.notifyGameInvite(q,v.id)}}).subscribe(x=>{console.log("[GameInviteNotification] Invite channel status:",x)}),N=Ae.channel(`friend-notify-${m}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"friendships",filter:`friend_id=eq.${m}`},async x=>{if(console.log("[GameInviteNotification] New friend request:",x),x.new.status==="pending"){const{data:v}=await Ae.from("profiles").select("id, username, display_name").eq("id",x.new.user_id).single();if(v){const q=v.display_name||v.username||"Someone";u(_=>[..._,{id:x.new.id,type:"friend_request",sender:q,senderId:v.id,timestamp:Date.now()}]),c.playSound("notification")}}}).subscribe(x=>{console.log("[GameInviteNotification] Friend channel status:",x)});return()=>{console.log("[GameInviteNotification] Cleaning up subscriptions"),s.unsubscribe(),N.unsubscribe()}},[m]),l.useEffect(()=>{const s=setInterval(()=>{const N=Date.now();u(x=>x.filter(v=>N-v.timestamp<3e4))},5e3);return()=>clearInterval(s)},[]);const f=l.useCallback(async s=>{u(N=>N.filter(x=>x.id!==s.id)),g?.(s)},[g]),p=l.useCallback(s=>{u(N=>N.filter(x=>x.id!==s.id)),T?.(s)},[T]),R=l.useCallback(s=>{u(N=>N.filter(x=>x.id!==s))},[]);return h.length===0?null:e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-3 max-w-sm",children:[h.map(s=>e.jsxs("div",{className:"bg-gradient-to-r from-slate-800/95 to-slate-900/95 backdrop-blur-sm rounded-xl p-4 shadow-lg border border-amber-500/30 animate-slide-in",children:[e.jsx("button",{onClick:()=>R(s.id),className:"absolute top-2 right-2 p-1 text-slate-500 hover:text-white transition-colors",children:e.jsx(I,{size:16})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${s.type==="invite"?"bg-amber-500/20":"bg-cyan-500/20"}`,children:s.type==="invite"?e.jsx(fe,{className:"w-5 h-5 text-amber-400"}):e.jsx(Ze,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-bold truncate",children:s.type==="invite"?"Game Challenge!":"Friend Request"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[e.jsx("span",{className:s.type==="invite"?"text-amber-400":"text-cyan-400",children:s.sender}),s.type==="invite"?" wants to play":" wants to be friends"]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>f(s),className:`flex-1 py-1.5 px-3 rounded-lg font-bold text-sm flex items-center justify-center gap-1.5 transition-all ${s.type==="invite"?"bg-amber-600 hover:bg-amber-500 text-white":"bg-cyan-600 hover:bg-cyan-500 text-white"}`,children:[e.jsx(ve,{size:14}),"Accept"]}),e.jsx("button",{onClick:()=>p(s),className:"py-1.5 px-3 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg text-sm transition-all",children:"Decline"})]})]})]})]},s.id)),e.jsx("style",{children:`
        @keyframes slide-in {
          from {
            opacity: 0;
            transform: translateX(100%);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        .animate-slide-in {
          animation: slide-in 0.3s ease-out;
        }
      `})]})},F={glow1:{color:"bg-amber-500/40",pos:"top-10 right-20"},glow2:{color:"bg-orange-500/35",pos:"bottom-20 left-10"},glow3:{color:"bg-yellow-500/20",pos:"top-1/3 left-1/3"},cardBg:"bg-gradient-to-br from-slate-900/95 via-amber-950/40 to-slate-900/95",cardBorder:"border-amber-500/40",cardShadow:"shadow-[0_0_50px_rgba(251,191,36,0.3),inset_0_0_20px_rgba(251,191,36,0.05)]"},Rs=({games:m,profile:g,onResume:T,onDismiss:h})=>{const u=m?.filter(s=>s&&U.isPlayerTurn(s,g?.id))||[];if(u.length===0)return null;const f=s=>s?s.player1_id===g?.id?s.player2?.username||s.player2?.display_name||"Unknown":s.player1?.username||s.player1?.display_name||"Unknown":"Unknown",p=u[0];if(!p)return null;const R=g?.username||g?.display_name;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:[e.jsxs("div",{className:"w-full max-w-sm bg-slate-900 rounded-2xl border border-amber-500/50 shadow-[0_0_60px_rgba(251,191,36,0.3)] overflow-hidden animate-scaleIn",children:[e.jsxs("div",{className:"bg-gradient-to-r from-amber-600 to-orange-600 p-4 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 p-1 text-white/70 hover:text-white transition-colors",children:e.jsx(I,{size:20})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(wt,{size:28,className:"text-white"}),e.jsx("h2",{className:"text-xl font-black text-white",children:"IT'S YOUR TURN!"})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("p",{className:"text-slate-400 text-center mb-4",children:["You have ",u.length===1?"a game":`${u.length} games`," waiting for your move"]}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-5 border border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white font-bold mb-1",children:R?.[0]?.toUpperCase()||"?"}),e.jsx("div",{className:"text-white text-xs font-medium",children:"You"})]}),e.jsx("div",{className:"text-xl font-black text-amber-400",children:"VS"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center text-white font-bold mb-1",children:f(p)?.[0]?.toUpperCase()||"?"}),e.jsx("div",{className:"text-white text-xs font-medium",children:f(p)})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>{c.playButtonClick(),T(p)},className:"w-full p-4 bg-gradient-to-r from-amber-500 to-orange-600 rounded-xl font-bold text-white hover:from-amber-400 hover:to-orange-500 transition-all shadow-[0_0_20px_rgba(251,191,36,0.4)] active:scale-[0.98]",children:"RESUME GAME"}),e.jsx("button",{onClick:h,className:"w-full p-3 text-slate-500 hover:text-slate-300 text-sm transition-colors",children:"Maybe Later"})]}),u.length>1&&e.jsxs("p",{className:"text-center text-amber-400/70 text-xs mt-3",children:["+",u.length-1," more ",u.length-1===1?"game":"games"," waiting"]})]})]}),e.jsx("style",{children:`
        @keyframes scaleIn {
          0% { transform: scale(0.9); opacity: 0; }
          100% { transform: scale(1); opacity: 1; }
        }
        .animate-scaleIn {
          animation: scaleIn 0.2s ease-out;
        }
      `})]})},Js=({onFindMatch:m,onViewProfile:g,onViewLeaderboard:T,onResumeGame:h,onSpectateGame:u,onViewReplay:f,onBack:p})=>{const{user:R,profile:s,signOut:N,refreshProfile:x,updateProfile:v,checkUsernameAvailable:q,sessionReady:_}=ls(),{needsScroll:Qe,viewportHeight:Pe}=is(1200),[L,ie]=l.useState([]),[O,Ge]=l.useState([]),[je,oe]=l.useState(!0),[X,Y]=l.useState(!1),[Ne,ee]=l.useState(!0),[te,W]=l.useState(!1),[Oe,J]=l.useState(!1),[B,ce]=l.useState(""),[D,S]=l.useState(""),[se,Z]=l.useState(!1),[we,de]=l.useState(!1),ke=l.useRef(!1);l.useEffect(()=>{if(ke.current||!x)return;(async()=>{ke.current=!0,W(!1);try{!await x()&&R&&(await new Promise(i=>setTimeout(i,1e3)),await x()||(console.error("OnlineMenu: Failed to load profile after retry"),W(!0)))}catch(a){console.error("OnlineMenu: Profile load error",a),W(!0)}})()},[]);const[Se,me]=l.useState(""),[ae,re]=l.useState([]),[Ce,_e]=l.useState(!1),[P,r]=l.useState(!1),[d,E]=l.useState(0),[z,w]=l.useState([]),[ne,St]=l.useState([]),[Ie,le]=l.useState(null),[xe,$]=l.useState(null),[Ke,Ct]=l.useState([]),[et,tt]=l.useState(""),[st,Me]=l.useState(!1),[Ls,As]=l.useState(!1),[at,Te]=l.useState(null),[qe,_t]=l.useState([]),[ue,Q]=l.useState(null),[rt,b]=l.useState(null),[It,Ee]=l.useState(!1),[Fs,nt]=l.useState(!1),[Tt,ze]=l.useState(!1),[Et,lt]=l.useState(!1),[zt,it]=l.useState(!1),[ot,Re]=l.useState(null),[Rt,Le]=l.useState(null),[Lt,he]=l.useState(!1),[At,pe]=l.useState(!1),[Ft,We]=l.useState(!1),[ct,$t]=l.useState(0),[dt,Ut]=l.useState(null),[A,mt]=l.useState(null);l.useEffect(()=>{(async()=>{if(await C.init(),nt(C.isEnabled()),!C.isMobileDevice()){Ee(!1);return}const a=localStorage.getItem("deadblock_notification_asked"),n=C.permission;!a&&n==="default"&&C.isPushSupported()?(localStorage.setItem("deadblock_notification_asked","true"),setTimeout(async()=>{const i=await C.requestPermission();nt(i==="granted"),Ee(!1)},1500)):Ee(C.shouldPrompt())})()},[]),l.useEffect(()=>{P&&setTimeout(()=>{const t=document.getElementById("challenge-section");t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})},100)},[P]),l.useEffect(()=>{const t=async()=>{if(s?.id)try{const{data:n}=await U.getMatchmakingCount?.();E(n?.count||0)}catch{}};t();const a=setInterval(t,3e4);return()=>clearInterval(a)},[s?.id]);const xt=async()=>{if(!_||!s?.id)return;const{data:t}=await G.getPendingRequests(s.id);$t(t?.length||0)};l.useEffect(()=>{xt()},[_,s?.id]),l.useEffect(()=>{if(!_||!s?.id)return;oe(!0),(async()=>{await M(),await k()})();const a=setInterval(()=>{M(),k()},45e3);let n=Date.now();const i=()=>{document.visibilityState==="visible"&&Date.now()-n>1e4&&(n=Date.now(),M(),k())};document.addEventListener("visibilitychange",i);const o=()=>{Date.now()-n>1e4&&(n=Date.now(),M(),k())};return window.addEventListener("focus",o),()=>{clearInterval(a),document.removeEventListener("visibilitychange",i),window.removeEventListener("focus",o)}},[_,s?.id]),l.useEffect(()=>{if(!_||!s?.id)return;const t=j.subscribeToInvites(s.id,async i=>{if(await k(),c.playButtonClick(),C.isEnabled()&&i?.from_user_id){const{data:o}=await j.getReceivedInvites(s.id),y=o?.find(V=>V.id===i.id);if(y?.from_user){const V=y.from_user.username||y.from_user.display_name;C.notifyGameInvite(V,i.id)}}},async i=>{if(await k(),i.status==="accepted"&&i.game_id&&(await M(),C.isEnabled()&&i.from_user_id===s.id)){const{data:o}=await U.getGame(i.game_id);if(o){const y=o.player1_id===s.id?o.player2?.username||o.player2?.display_name:o.player1?.username||o.player1?.display_name;C.notifyInviteAccepted(y||"Opponent",i.game_id)}}}),a=gt.on("emailInviteUpdated",async i=>{await k(),i?.status==="accepted"&&i?.game_id&&(await M(),c.playSound("notification"))}),n=gt.on("rematchRequest",async i=>{if(await k(),i?.to_user_id===s.id&&i?.status==="pending"&&(c.playSound("notification"),C.isEnabled())){const{data:o}=await U.getGame(i.game_id);if(o){const y=o.player1_id===i.from_user_id?o.player1?.username||o.player1?.display_name:o.player2?.username||o.player2?.display_name;C.notifyRematchRequest(y||"Opponent",i.game_id,i.id)}}if(i?.status==="accepted"&&i?.new_game_id&&(await M(),c.playSound("notification"),C.isEnabled()&&i?.from_user_id===s.id)){const{data:o}=await U.getGame(i.new_game_id);if(o){const y=o.player1_id===s.id?o.player2?.username||o.player2?.display_name:o.player1?.username||o.player1?.display_name;C.notifyRematchAccepted(y||"Opponent",i.new_game_id)}}});return()=>{j.unsubscribeFromInvites(t),a&&a(),n&&n()}},[_,s?.id]);const k=async()=>{if(s?.id)try{const[t,a,n,i]=await Promise.all([j.getReceivedInvites(s.id),j.getSentInvites(s.id),j.getInviteLinks(s.id),Fe.getPendingRematchRequests(s.id)]);w(t.data||[]),St(a.data||[]);const o=(n.data||[]).filter(y=>!y.game_id);Ct(o),_t(i.data||[])}catch(t){console.error("Error loading invites:",t)}},De=l.useRef(!1),M=async()=>{if(!s?.id){oe(!1);return}if(!De.current){De.current=!0;try{const t=localStorage.getItem("deadblock_last_stale_check"),a=Date.now()-6*60*60*1e3;if(!t||parseInt(t)<a){const{forfeited:y}=await U.checkAndForfeitStaleGames(s.id);y?.length>0&&console.log(`[OnlineMenu] Auto-forfeited ${y.length} stale game(s)`),localStorage.setItem("deadblock_last_stale_check",Date.now().toString())}const{data:n}=await U.getActiveAndUnviewedGames(s.id);ie(n||[]);const{data:i}=await U.getPlayerGames(s.id,10),o=(i||[]).filter(y=>y.status==="completed");Ge(o)}catch(t){console.error("Error loading games:",t)}De.current=!1,oe(!1)}},Bt=async()=>{c.playButtonClick();try{const{error:t}=await N();t&&console.error("Sign out error:",t)}catch(t){console.error("Sign out exception:",t)}p()},Pt=async()=>{X||(Y(!0),c.playButtonClick(),x&&await x(),await M(),await k(),Y(!1))},Gt=()=>{c.playButtonClick(),m()},Ve=()=>{c.playButtonClick(),p()},Ot=()=>{ce(s?.username||""),S(""),J(!0),c.playButtonClick()},Mt=async t=>{if(ce(t),S(""),t.length<3){S("Name must be at least 3 characters");return}if(t.length>20){S("Name must be 20 characters or less");return}if(!/^[a-zA-Z0-9_]+$/.test(t)){S("Only letters, numbers, and underscores allowed");return}if(t.toLowerCase()!==s?.username?.toLowerCase()){Z(!0);try{const{available:a,error:n}=await q(t);if(n){S("Error checking availability"),Z(!1);return}if(!a){S("This name is already taken"),Z(!1);return}const i={apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95ZWlieXJlZG53bG9sbXNqbHdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMzMyNzQsImV4cCI6MjA4MDgwOTI3NH0.GNMI2HOyOn_YHPPgsrkinB5FipLedqo0bTN9PKRQJMY","Content-Type":"application/json"},o=localStorage.getItem(`sb-${"https://oyeibyrednwlolmsjlwk.supabase.co".split("//")[1]?.split(".")[0]}-auth-token`);if(o)try{const H=JSON.parse(o);H?.access_token&&(i.Authorization=`Bearer ${H.access_token}`)}catch{}const y=`https://oyeibyrednwlolmsjlwk.supabase.co/rest/v1/profiles?select=id&display_name=ilike.${encodeURIComponent(t)}&id=neq.${s?.id}&limit=1`,V=await fetch(y,{headers:i});if(V.ok){const H=await V.json();if(H&&H.length>0){S("This name is already taken"),Z(!1);return}}}catch(a){console.error("Error checking name availability:",a),S("Error checking availability")}Z(!1)}},qt=async()=>{if(D||se||!B)return;de(!0);const{error:t}=await v({username:B.toLowerCase(),display_name:B});if(de(!1),t){const a=t.message||"";a.includes("unique")||a.includes("duplicate")||a.includes("already")?S("This name is already taken"):a.includes("length")||a.includes("too short")||a.includes("too long")?S("Name must be 3-20 characters"):S(a||"Failed to update name")}else c.playSound("success"),J(!1)},Wt=l.useCallback(async t=>{if(me(t),t.length<2){re([]);return}_e(!0);const{data:a}=await j.searchUsers(t,s?.id);re(a||[]),_e(!1)},[s?.id]),Dt=async t=>{if(!s?.id)return;le(t),c.playButtonClick();const{data:a,error:n}=await j.sendInvite(s.id,t);n?(console.error("Error sending invite:",n),b(n.message||"Failed to send invite"),setTimeout(()=>b(null),5e3)):a?.game?(c.playSound("win"),h(a.game)):(c.playClickSound("confirm"),await k(),re(i=>i.filter(o=>o.id!==t))),le(null)},Vt=async t=>{if(s?.id){$(t.id),c.playButtonClick();try{const{data:a,error:n}=await j.acceptInvite(t.id,s.id,"invitee");if(n){console.error("Error accepting invite:",n),b(n.message||"Failed to accept invite"),setTimeout(()=>b(null),5e3),$(null);return}a?.game?(c.playSound("win"),w(i=>i.filter(o=>o.id!==t.id)),$(null),k().catch(()=>{}),await new Promise(i=>setTimeout(i,100)),h(a.game)):(console.error("handleAcceptInvite: No game in response",a),b("Error: Game was not created properly. Please try again."),setTimeout(()=>b(null),5e3),$(null))}catch(a){console.error("handleAcceptInvite: Exception",a),b("An unexpected error occurred: "+(a.message||"Unknown error")),setTimeout(()=>b(null),5e3),$(null)}}},Ht=async t=>{s?.id&&($(t.id),c.playButtonClick(),await j.declineInvite(t.id,s.id),await k(),$(null))},Xt=async t=>{if(s?.id){$(t.id),c.playButtonClick();try{const{error:a}=await j.cancelInvite(t.id,s.id);a&&(b(a.message||"Failed to cancel invite"),setTimeout(()=>b(null),5e3)),await k()}catch(a){console.error("handleCancelInvite error:",a),b("Failed to cancel invite"),setTimeout(()=>b(null),5e3)}$(null)}},ut=async()=>{if(s?.id){Me(!0),c.playButtonClick();try{const{data:t,error:a}=await j.createInviteLink(s.id,et.trim());if(a){b(a.message||"Failed to create invite link"),setTimeout(()=>b(null),5e3),Me(!1);return}if(c.playClickSound("confirm"),tt(""),await k(),t?.inviteLink)try{await navigator.clipboard.writeText(t.inviteLink),Te(t.id),setTimeout(()=>Te(null),2e3)}catch{}}catch(t){console.error("handleCreateInviteLink error:",t),b("Failed to create invite: "+t.message),setTimeout(()=>b(null),5e3)}Me(!1)}},ht=async t=>{try{await navigator.clipboard.writeText(t.inviteLink),Te(t.id),c.playClickSound("confirm"),await j.markInviteLinkShared(t.id,s.id),setTimeout(()=>Te(null),2e3)}catch(a){console.error("Failed to copy:",a),b(`Could not auto-copy. Link: ${t.inviteLink}`),setTimeout(()=>b(null),8e3)}},Yt=async t=>{if(navigator.share)try{await navigator.share({title:"Play Deadblock with me!",text:`${s?.username||s?.display_name||"A friend"} wants to challenge you to Deadblock!`,url:t.inviteLink}),c.playClickSound("confirm"),await j.markInviteLinkShared(t.id,s.id)}catch(a){a.name!=="AbortError"&&console.error("Share failed:",a)}else ht(t)},Jt=async t=>{s?.id&&($(t.id),c.playButtonClick(),await j.cancelInviteLink(t.id,s.id),await k(),$(null))},Zt=async t=>{if(!(!s?.id||!t?.id)){Q(t.id),c.playButtonClick();try{const{data:a,error:n}=await Fe.acceptRematchRequest(t.id,s.id);if(n){console.error("Error accepting rematch:",n),b(n.message||"Failed to accept rematch"),setTimeout(()=>b(null),5e3),Q(null);return}a?.game&&(c.playSound("win"),await k(),await M(),h(a.game))}catch(a){console.error("handleAcceptRematch error:",a),b("Failed to accept rematch: "+a.message),setTimeout(()=>b(null),5e3)}Q(null)}},Qt=async t=>{if(!(!s?.id||!t?.id)){Q(t.id),c.playButtonClick();try{await Fe.declineRematchRequest(t.id,s.id),await k()}catch(a){console.error("handleDeclineRematch error:",a)}Q(null)}},Kt=async t=>{if(!(!s?.id||!t?.id)){Q(t.id),c.playButtonClick();try{await Fe.cancelRematchRequest(t.id,s.id),await k()}catch(a){console.error("handleCancelRematch error:",a)}Q(null)}},pt=t=>t?t.player1_id===s?.id?t.player2?.username||t.player2?.display_name||"Unknown":t.player1?.username||t.player1?.display_name||"Unknown":"Unknown",es=t=>!t||!s?.id?{id:null,username:"Unknown",displayName:"Unknown"}:t.player1_id===s.id?{id:t.player2_id,username:t.player2?.username||"Unknown",displayName:t.player2?.username||t.player2?.display_name||"Unknown",data:t.player2}:{id:t.player1_id,username:t.player1?.username||"Unknown",displayName:t.player1?.username||t.player1?.display_name||"Unknown",data:t.player1},ts=t=>t?t.winner_id?t.winner_id===s?.id?{text:"Won",color:"text-green-400"}:{text:"Lost",color:"text-red-400"}:{text:"Draw",color:"text-slate-400"}:{text:"Unknown",color:"text-slate-400"},ss=L?.some(t=>t&&U.isPlayerTurn(t,s?.id))||!1;return e.jsxs("div",{className:"fixed inset-0 bg-transparent overflow-y-auto overflow-x-hidden",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[e.jsx("div",{className:`fixed ${F.glow1.pos} w-80 h-80 ${F.glow1.color} rounded-full blur-3xl pointer-events-none`}),e.jsx("div",{className:`fixed ${F.glow2.pos} w-72 h-72 ${F.glow2.color} rounded-full blur-3xl pointer-events-none`}),e.jsx("div",{className:`fixed ${F.glow3.pos} w-64 h-64 ${F.glow3.color} rounded-full blur-3xl pointer-events-none`}),Ne&&ss&&!je&&e.jsx(Rs,{games:L,profile:s,onResume:t=>{ee(!1),h(t)},onDismiss:()=>ee(!1)}),e.jsxs("div",{className:"relative flex flex-col items-center px-3 sm:px-4 pt-6 sm:pt-8 pb-32",style:{minHeight:"100%",paddingBottom:"max(160px, calc(env(safe-area-inset-bottom) + 160px))",paddingTop:"max(24px, env(safe-area-inset-top))"},children:[e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx(os,{size:"xlarge"}),e.jsx(cs,{text:"ONLINE",size:"large",className:"mt-2"})]}),(te||!s&&R)&&e.jsx("div",{className:`${F.cardBg} backdrop-blur-md rounded-2xl p-5 border ${F.cardBorder} ${F.cardShadow} mb-4`,children:e.jsx("div",{className:"text-center py-8",children:te?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-red-400 mb-4",children:[e.jsx(I,{size:48,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-lg font-bold",children:"Failed to load profile"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"There was an issue connecting to the server"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:async()=>{W(!1),Y(!0),await x()||W(!0),Y(!1)},disabled:X,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg font-bold flex items-center gap-2",children:[e.jsx(Xe,{size:16,className:X?"animate-spin":""}),"Retry"]}),e.jsx("button",{onClick:Ve,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold",children:"Back"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 border-4 border-amber-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-amber-300 font-medium",children:"Loading profile..."})]})})}),s&&e.jsxs("div",{className:`${F.cardBg} backdrop-blur-md rounded-2xl p-5 border ${F.cardBorder} ${F.cardShadow}`,children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white text-xl font-bold shadow-lg shadow-amber-500/30",children:(s?.username||s?.display_name)?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:s?.username||s?.display_name||"Player"}),e.jsx("button",{onClick:Ot,className:"p-1 text-slate-500 hover:text-amber-400 transition-colors",title:"Edit Username",children:e.jsx(ft,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:[s?.games_played||0," games"]}),e.jsxs("span",{className:"text-green-400",children:[s?.games_won||0," wins"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:Pt,disabled:X,className:`p-2 text-slate-500 hover:text-amber-400 transition-colors ${X?"animate-spin":""}`,title:"Refresh",children:e.jsx(Xe,{size:18})}),e.jsx("button",{onClick:Bt,className:"p-2 text-slate-500 hover:text-red-400 transition-colors",title:"Sign Out",children:e.jsx(ds,{size:20})})]})]}),(()=>{const t=ge.getRatingTier(s?.rating||1e3),a=t?.glowColor||"#22d3ee",n=(o,y)=>{if(!o?.startsWith("#"))return`rgba(100, 116, 139, ${y})`;const V=parseInt(o.slice(1,3),16),H=parseInt(o.slice(3,5),16),as=parseInt(o.slice(5,7),16);return`rgba(${V}, ${H}, ${as}, ${y})`},i=()=>({"#f59e0b":"rgba(30, 20, 60, 0.95)","#a855f7":"rgba(20, 40, 40, 0.95)","#3b82f6":"rgba(40, 25, 20, 0.95)","#22d3ee":"rgba(40, 20, 40, 0.95)","#22c55e":"rgba(40, 20, 35, 0.95)","#38bdf8":"rgba(35, 25, 45, 0.95)","#2dd4bf":"rgba(40, 25, 50, 0.95)"})[a]||"rgba(15, 23, 42, 0.95)";return e.jsxs("div",{className:"flex items-center justify-between rounded-lg px-3 py-3",style:{background:`linear-gradient(135deg, ${i()} 0%, ${n(a,.15)} 100%)`,border:`2px solid ${n(a,.4)}`,boxShadow:`0 0 20px ${n(a,.2)}, inset 0 0 30px ${n(a,.05)}`},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-full flex items-center justify-center",style:{background:`radial-gradient(circle at 30% 30%, ${i()}, rgba(10, 15, 25, 0.98))`,border:`2px solid ${n(a,.5)}`,boxShadow:`0 0 15px ${n(a,.35)}, inset 0 0 10px ${n(a,.1)}`},children:e.jsx(K,{shape:t.shape,glowColor:t.glowColor,size:"medium"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base",style:{color:a,textShadow:`0 0 10px ${n(a,.5)}`},children:t.name}),e.jsx("div",{className:"text-xs text-slate-500",children:"Rating Tier"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-black",style:{color:a,textShadow:`0 0 12px ${n(a,.5)}`},children:s?.rating||1e3}),e.jsx("div",{className:"text-xs text-slate-500",children:"ELO"})]}),e.jsx("button",{onClick:()=>{c.playButtonClick(),We(!0)},className:"p-2 rounded-lg transition-all hover:bg-slate-800/50",style:{color:n(a,.6)},title:"How Ratings Work",children:e.jsx(ms,{size:18})})]})})()]}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>{c.playButtonClick(),g()},className:"flex-1 py-2.5 rounded-xl text-xs font-medium transition-all flex items-center justify-center gap-1.5 border group",style:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(30, 41, 59, 0.8) 100%)",borderColor:"rgba(59, 130, 246, 0.3)",boxShadow:"0 0 15px rgba(59, 130, 246, 0.1), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsx(xs,{size:14,className:"text-blue-400 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-slate-300 group-hover:text-blue-300 transition-colors",children:"Profile"})]}),e.jsxs("button",{onClick:()=>{c.playButtonClick(),lt(!0)},className:"flex-1 py-2.5 rounded-xl text-xs font-medium transition-all flex items-center justify-center gap-1.5 border group",style:{background:"linear-gradient(135deg, rgba(168, 85, 247, 0.15) 0%, rgba(30, 41, 59, 0.8) 100%)",borderColor:"rgba(168, 85, 247, 0.3)",boxShadow:"0 0 15px rgba(168, 85, 247, 0.1), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsx(us,{size:14,className:"text-purple-400 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-slate-300 group-hover:text-purple-300 transition-colors",children:"Awards"})]}),e.jsxs("button",{onClick:()=>{c.playButtonClick(),ze(!0)},className:"flex-1 py-2.5 rounded-xl text-xs font-medium transition-all flex items-center justify-center gap-1.5 border group relative",style:{background:"linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(30, 41, 59, 0.8) 100%)",borderColor:"rgba(34, 211, 238, 0.3)",boxShadow:"0 0 15px rgba(34, 211, 238, 0.1), inset 0 1px 0 rgba(255,255,255,0.05)"},children:[e.jsx(Je,{size:14,className:"text-cyan-400 group-hover:scale-110 transition-transform"}),e.jsx("span",{className:"text-slate-300 group-hover:text-cyan-300 transition-colors",children:"Friends"}),ct>0&&e.jsx("span",{className:"absolute -top-1.5 -right-1 bg-red-500 text-white text-[10px] rounded-full min-w-[18px] h-[18px] flex items-center justify-center font-bold px-1 shadow-lg shadow-red-500/50",children:ct})]})]}),e.jsxs("button",{onClick:()=>{c.playButtonClick(),T()},className:`w-full p-3 mb-3 rounded-xl transition-all duration-300 relative overflow-hidden group
    border-2 border-yellow-500/50
    hover:border-yellow-400/70 hover:ring-4 ring-yellow-500/30
    active:scale-[0.98]`,style:{background:"linear-gradient(135deg, rgba(234, 179, 8, 0.25) 0%, rgba(161, 98, 7, 0.3) 100%)",boxShadow:"0 0 30px rgba(234, 179, 8, 0.4), inset 0 1px 0 rgba(255,255,255,0.1)"},onMouseEnter:t=>{t.currentTarget.style.boxShadow="0 0 50px rgba(234, 179, 8, 0.6)",t.currentTarget.style.background="linear-gradient(135deg, rgba(234, 179, 8, 0.4) 0%, rgba(161, 98, 7, 0.5) 100%)"},onMouseLeave:t=>{t.currentTarget.style.boxShadow="0 0 30px rgba(234, 179, 8, 0.4), inset 0 1px 0 rgba(255,255,255,0.1)",t.currentTarget.style.background="linear-gradient(135deg, rgba(234, 179, 8, 0.25) 0%, rgba(161, 98, 7, 0.3) 100%)"},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl opacity-0 group-hover:opacity-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shine"})}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(Ye,{size:20,className:"text-yellow-400"}),e.jsx("span",{className:"font-black tracking-wide text-sm text-yellow-300 group-hover:text-white transition-colors",children:"VIEW LEADERBOARD"})]})]}),e.jsxs("button",{onClick:Gt,className:`w-full p-3 mb-2 rounded-xl transition-all duration-300 relative overflow-hidden group
    bg-cyan-900/30 border-2 border-cyan-500/40
    hover:border-white/40 hover:ring-4 ring-cyan-500/50
    active:scale-[0.98]`,style:{boxShadow:"0 0 25px rgba(34,211,238,0.3)"},onMouseEnter:t=>{t.currentTarget.style.boxShadow="0 0 40px rgba(34,211,238,0.6)",t.currentTarget.style.background="linear-gradient(to right, #06b6d4, #0891b2)"},onMouseLeave:t=>{t.currentTarget.style.boxShadow="0 0 25px rgba(34,211,238,0.3)",t.currentTarget.style.background=""},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl opacity-0 group-hover:opacity-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shine"})}),e.jsxs("div",{className:"relative flex items-center justify-center gap-3",children:[e.jsx("span",{className:"font-black tracking-wide text-sm text-cyan-300 group-hover:text-white transition-colors",children:"FIND MATCH"}),d>0&&e.jsxs("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs font-normal text-white",children:[d," in queue"]})]})]}),rt&&e.jsx("div",{className:"mb-3 p-3 bg-red-900/40 border border-red-500/50 rounded-xl animate-scaleIn",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-1.5 bg-red-500/20 rounded-lg shrink-0",children:e.jsx(I,{size:16,className:"text-red-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-red-300 text-sm font-medium",children:rt})}),e.jsx("button",{onClick:()=>b(null),className:"text-red-400/60 hover:text-red-300 transition-colors p-1",children:e.jsx(I,{size:14})})]})}),e.jsxs("button",{onClick:()=>{c.playButtonClick(),r(!P),P||(me(""),re([]))},className:`w-full p-3 mb-2 rounded-xl transition-all duration-300 relative overflow-hidden group
                bg-purple-900/30 border-2 border-purple-500/40
                hover:border-white/40 hover:ring-4 ring-purple-500/50
                active:scale-[0.98]`,style:{boxShadow:"0 0 25px rgba(168,85,247,0.3)"},onMouseEnter:t=>{t.currentTarget.style.boxShadow="0 0 40px rgba(168,85,247,0.6)",t.currentTarget.style.background="linear-gradient(to right, #a855f7, #9333ea)"},onMouseLeave:t=>{t.currentTarget.style.boxShadow="0 0 25px rgba(168,85,247,0.3)",t.currentTarget.style.background=""},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl opacity-0 group-hover:opacity-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shine"})}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx("span",{className:"font-black tracking-wide text-sm text-purple-300 group-hover:text-white transition-colors",children:"CHALLENGE A PLAYER"}),e.jsx(be,{size:16,className:`text-purple-400 group-hover:text-white transition-all ${P?"rotate-90":""}`})]})]}),P&&e.jsxs("div",{className:"bg-slate-800/60 rounded-xl p-3 mb-2 border border-purple-500/30 space-y-3",style:{boxShadow:"0 0 15px rgba(168,85,247,0.15)",touchAction:"pan-y",WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($e,{size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-purple-300 text-xs font-bold tracking-wide",children:"SEARCH EXISTING ACCOUNTS"})]}),e.jsx("p",{className:"text-slate-400 text-xs mb-3",children:"Find players by their username or email address"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{type:"text",value:Se,onChange:t=>Wt(t.target.value),placeholder:"Enter username or email...",className:"w-full pl-9 pr-4 py-2.5 bg-slate-800 rounded-lg text-white text-sm border border-slate-700/50 focus:border-purple-500/50 focus:outline-none placeholder:text-slate-600",style:{touchAction:"manipulation"}}),Ce&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-purple-400 border-t-transparent rounded-full animate-spin"})})]}),ae.length>0&&e.jsxs("div",{className:"space-y-2 mt-3 max-h-48 overflow-y-auto",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)"},children:["                      ",ae.map(t=>{const a=ne.some(i=>i.to_user_id===t.id),n=t.username||t.display_name;return e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-slate-800/60 rounded-lg border border-slate-700/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-bold",children:n?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-sm font-medium",children:n}),e.jsxs("div",{className:"text-cyan-400/70 text-xs flex items-center gap-1",children:[e.jsx(K,{shape:ge.getRatingTier(t.rating||1e3).shape,glowColor:ge.getRatingTier(t.rating||1e3).glowColor,size:"small"}),e.jsx("span",{children:t.rating||1e3})]})]})]}),e.jsx("button",{onClick:()=>Dt(t.id),disabled:Ie===t.id||a,className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1 ${a?"bg-slate-700 text-slate-500 cursor-not-allowed":"bg-cyan-500 text-white hover:bg-cyan-400 active:scale-95"}`,children:Ie===t.id?e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):a?e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:12}),"Sent"]}):e.jsxs(e.Fragment,{children:[e.jsx(fs,{size:12}),"Challenge"]})})]},t.id)})]}),Se.length>=2&&!Ce&&ae.length===0&&e.jsx("p",{className:"text-slate-500 text-xs text-center py-2 mt-2",children:"No players found"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Nt,{size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-purple-300 text-xs font-bold tracking-wide",children:"INVITE VIA LINK"})]}),e.jsx("p",{className:"text-slate-400 text-xs mb-3",children:"Create a shareable link for friends who don't have an account yet"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),e.jsx("input",{type:"text",value:et,onChange:t=>tt(t.target.value),placeholder:"Friend's name (optional)",className:"w-full pl-9 pr-4 py-2.5 bg-slate-800 rounded-lg text-white text-sm border border-slate-700/50 focus:border-purple-500/50 focus:outline-none placeholder:text-slate-600",style:{touchAction:"manipulation"},onKeyDown:t=>{t.key==="Enter"&&ut()}})]}),e.jsx("button",{onClick:ut,disabled:st,className:"px-4 py-2.5 bg-purple-500 text-white rounded-lg font-medium text-sm hover:bg-purple-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:st?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{size:14}),"Create"]})})]}),Ke.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700/50",children:[e.jsx("p",{className:"text-slate-400 text-xs mb-2 font-medium",children:"Your active invite links:"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)"},children:Ke.map(t=>e.jsxs("div",{className:"p-3 bg-slate-800/40 rounded-lg border border-slate-700/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white text-sm font-medium",children:t.recipientName||"Friend"}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] ${t.status==="sent"?"bg-blue-900/50 text-blue-400":"bg-amber-900/50 text-amber-400"}`,title:t.status==="sent"?"Link has been copied/shared":"Link created, ready to share",children:t.status==="sent"?"Copied":"New"})]}),e.jsx("button",{onClick:()=>Jt(t),disabled:xe===t.id,className:"text-slate-500 hover:text-red-400 transition-colors p-1 disabled:opacity-50",title:"Delete invite link",children:e.jsx(I,{size:14})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ht(t),className:`flex-1 py-2 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-1.5 ${at===t.id?"bg-green-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:at===t.id?e.jsxs(e.Fragment,{children:[e.jsx(ve,{size:12}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Cs,{size:12}),"Copy Link"]})}),navigator.share&&e.jsxs("button",{onClick:()=>Yt(t),className:"flex-1 py-2 bg-amber-500 text-white rounded-lg text-xs font-medium hover:bg-amber-400 transition-all flex items-center justify-center gap-1.5",children:[e.jsx(Ss,{size:12}),"Share"]})]})]},t.id))})]})]})]}),qe.length>0&&e.jsxs("div",{className:"bg-orange-900/20 rounded-xl p-4 mb-4 border border-orange-500/30",children:[e.jsxs("h3",{className:"text-orange-400 font-bold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Xe,{size:16}),"REMATCH REQUESTS (",qe.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-1",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)"},children:qe.map(t=>{const a=t.is_sender,n=t.opponent_name||"Opponent",i=n?.[0]?.toUpperCase()||"?";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/60 rounded-lg border border-orange-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-600 flex items-center justify-center text-white text-xs font-bold",children:i}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-sm font-medium",children:n}),e.jsx("div",{className:"text-orange-400/70 text-xs",children:a?"Waiting for response...":"Wants a rematch!"})]})]}),e.jsx("div",{className:"flex gap-2",children:a?e.jsx("button",{onClick:()=>Kt(t),disabled:ue===t.id,className:"px-3 py-1.5 text-xs bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition-all active:scale-95 disabled:opacity-50",children:ue===t.id?e.jsx("div",{className:"w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"}):"Cancel"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Zt(t),disabled:ue===t.id,className:"p-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-all active:scale-95 disabled:opacity-50",children:ue===t.id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ve,{size:16})}),e.jsx("button",{onClick:()=>Qt(t),disabled:ue===t.id,className:"p-2 bg-slate-700 text-slate-400 rounded-lg hover:bg-slate-600 hover:text-white transition-all active:scale-95 disabled:opacity-50",children:e.jsx(I,{size:16})})]})})]},t.id)})})]}),z.length>0&&e.jsxs("div",{className:"bg-green-900/20 rounded-xl p-4 mb-4 border border-green-500/30",children:[e.jsxs("h3",{className:"text-green-400 font-bold text-sm mb-3 flex items-center gap-2",children:[e.jsx(hs,{size:16}),"GAME INVITES (",z.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-1",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)"},children:z.map(t=>{const a=t.from_user?.username||t.from_user?.display_name||"Unknown";return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/60 rounded-lg border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center text-white text-xs font-bold",children:a?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white text-sm font-medium",children:a}),e.jsx("div",{className:"text-green-400/70 text-xs",children:"wants to play!"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Vt(t),disabled:xe===t.id,className:"p-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition-all active:scale-95 disabled:opacity-50",children:xe===t.id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ve,{size:16})}),e.jsx("button",{onClick:()=>Ht(t),disabled:xe===t.id,className:"p-2 bg-slate-700 text-slate-400 rounded-lg hover:bg-slate-600 hover:text-white transition-all active:scale-95 disabled:opacity-50",children:e.jsx(I,{size:16})})]})]},t.id)})})]}),ne.length>0&&e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 mb-4 border border-slate-700/50",children:[e.jsxs("h3",{className:"text-slate-400 font-bold text-sm mb-3 flex items-center gap-2",children:[e.jsx(ye,{size:16}),"PENDING INVITES (",ne.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-1",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)"},children:ne.map(t=>{const a=t.to_user?.display_name||t.to_user?.username||t.recipientName||"Player",n=a?.[0]?.toUpperCase()||"?";return e.jsxs("div",{className:"flex items-center justify-between p-2.5 bg-slate-900/40 rounded-lg border border-slate-700/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-600/80 flex items-center justify-center text-white text-xs font-bold",children:n}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-300 text-sm font-medium",children:a}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Waiting for response..."})]})]}),e.jsx("button",{onClick:()=>Xt(t),disabled:xe===t.id,className:"text-xs text-slate-500 hover:text-red-400 transition-colors disabled:opacity-50 px-2 py-1",children:"Cancel"})]},t.id)})})]}),L.length>0&&(()=>{const t=L.filter(a=>U.isPlayerTurn(a,s?.id)).length;return L.length-t,e.jsxs("button",{onClick:()=>{c.playButtonClick(),pe(!0)},className:`w-full p-3 mb-2 rounded-xl transition-all duration-300 relative overflow-hidden group
                    bg-green-900/30 border-2 border-green-500/40
                    hover:border-white/40 hover:ring-4 ring-green-500/50
                    active:scale-[0.98]`,style:{boxShadow:"0 0 25px rgba(34,197,94,0.3)"},onMouseEnter:a=>{a.currentTarget.style.boxShadow="0 0 40px rgba(34,197,94,0.6)",a.currentTarget.style.background="linear-gradient(to right, #22c55e, #16a34a)"},onMouseLeave:a=>{a.currentTarget.style.boxShadow="0 0 25px rgba(34,197,94,0.3)",a.currentTarget.style.background=""},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl opacity-0 group-hover:opacity-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shine"})}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsxs("span",{className:"font-black tracking-wide text-sm text-green-300 group-hover:text-white transition-colors",children:["ACTIVE GAMES (",L.length,")"]}),t>0&&e.jsxs("span",{className:"bg-amber-500/80 px-2 py-0.5 rounded-full text-xs font-bold text-white animate-pulse",children:[t," your turn!"]})]})]})})(),O.length>0&&e.jsxs("button",{onClick:()=>{c.playButtonClick(),he(!0)},className:`w-full p-3 mb-2 rounded-xl transition-all duration-300 relative overflow-hidden group
                  bg-rose-900/30 border-2 border-rose-500/40
                  hover:border-white/40 hover:ring-4 ring-rose-500/50
                  active:scale-[0.98]`,style:{boxShadow:"0 0 25px rgba(244,63,94,0.3)"},onMouseEnter:t=>{t.currentTarget.style.boxShadow="0 0 40px rgba(244,63,94,0.6)",t.currentTarget.style.background="linear-gradient(to right, #e11d48, #be123c)"},onMouseLeave:t=>{t.currentTarget.style.boxShadow="0 0 25px rgba(244,63,94,0.3)",t.currentTarget.style.background=""},children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl opacity-0 group-hover:opacity-100",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shine"})}),e.jsx("div",{className:"relative flex items-center justify-center gap-2",children:e.jsxs("span",{className:"font-black tracking-wide text-sm text-rose-300 group-hover:text-white transition-colors",children:["RECENT GAMES (",O.length,")"]})})]}),e.jsxs("button",{onClick:Ve,className:"w-full mt-3 py-2 px-4 rounded-xl font-bold text-sm text-slate-300 bg-slate-800/70 hover:bg-slate-700/70 transition-all border border-slate-600/50 hover:border-slate-500/50 flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(100,116,139,0.2)]",children:[e.jsx(vt,{size:16}),"GAME MENU"]})]}),(te||!s&&R)&&e.jsxs("button",{onClick:Ve,className:"w-full mt-4 py-3 px-4 rounded-xl font-bold text-base text-slate-300 bg-slate-800/70 hover:bg-slate-700/70 transition-all border border-slate-600/50 hover:border-slate-500/50 flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(100,116,139,0.2)]",children:[e.jsx(vt,{size:18}),"BACK TO MENU"]})]}),e.jsx("div",{className:"h-40 w-full flex-shrink-0","aria-hidden":"true"})]}),It&&e.jsx(Is,{onDismiss:()=>Ee(!1)}),s?.id&&e.jsx(zs,{userId:s.id,onAccept:async t=>{if(t.type==="invite"){const{data:a,error:n}=await j.acceptInvite(t.id,s.id,"invitee");!n&&a?.game&&(c.playSound("success"),w(i=>i.filter(o=>o.id!==t.id)),k().catch(()=>{}),h?.(a.game))}else t.type==="friend_request"&&(await G.acceptFriendRequest(t.id,s.id),xt(),c.playSound("success"))},onDecline:t=>{t.type==="friend_request"&&G.declineFriendRequest(t.id,s.id)}}),Ft&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-sm w-full overflow-hidden border border-amber-500/30 shadow-[0_0_50px_rgba(251,191,36,0.2)]",children:[e.jsx("div",{className:"p-4 border-b border-amber-500/20",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 relative",children:[e.jsx(Ye,{size:20,className:"text-amber-400"}),e.jsx("h2",{className:"text-lg font-bold text-amber-300",children:"What is ELO?"}),e.jsx("button",{onClick:()=>We(!1),className:"absolute right-0 p-1 text-slate-400 hover:text-white transition-colors",children:e.jsx(I,{size:24})})]})}),e.jsxs("div",{className:"p-4 space-y-4 max-h-[70vh] overflow-y-auto",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translate3d(0, 0, 0)",willChange:"scroll-position"},children:[">",e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-300",children:[e.jsx("span",{className:"text-amber-400 font-bold",children:"ELO"})," is a skill rating system named after ",e.jsx("span",{className:"text-amber-300",children:"Arpad Elo"}),", the physicist who created it for chess. It measures your relative skill level compared to other players."]}),e.jsx("p",{className:"text-sm text-slate-400",children:"When you win, you gain points. When you lose, you lose points. The amount depends on your opponent's rating:"}),e.jsxs("ul",{className:"text-sm text-slate-400 space-y-1 ml-4",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"▲"}),e.jsxs("span",{children:["Beat a ",e.jsx("span",{className:"text-amber-300",children:"stronger"})," player = big gain"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"▲"}),e.jsxs("span",{children:["Beat a ",e.jsx("span",{className:"text-slate-300",children:"weaker"})," player = small gain"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400",children:"▼"}),e.jsxs("span",{children:["Lose to a ",e.jsx("span",{className:"text-amber-300",children:"stronger"})," player = small loss"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400",children:"▼"}),e.jsxs("span",{children:["Lose to a ",e.jsx("span",{className:"text-slate-300",children:"weaker"})," player = big loss"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-300 mb-2",children:"Rating Tiers"}),[{min:2200,name:"Grandmaster",shape:"X",color:"text-amber-400",glowColor:"#f59e0b",bg:"bg-amber-500/10 border-amber-500/30"},{min:2e3,name:"Master",shape:"W",color:"text-purple-400",glowColor:"#a855f7",bg:"bg-purple-500/10 border-purple-500/30"},{min:1800,name:"Expert",shape:"T",color:"text-blue-400",glowColor:"#3b82f6",bg:"bg-blue-500/10 border-blue-500/30"},{min:1600,name:"Advanced",shape:"Y",color:"text-cyan-400",glowColor:"#22d3ee",bg:"bg-cyan-500/10 border-cyan-500/30"},{min:1400,name:"Intermediate",shape:"L",color:"text-green-400",glowColor:"#22c55e",bg:"bg-green-500/10 border-green-500/30"},{min:1200,name:"Beginner",shape:"I",color:"text-sky-400",glowColor:"#38bdf8",bg:"bg-sky-500/10 border-sky-500/30"},{min:0,name:"Novice",shape:"O",color:"text-teal-400",glowColor:"#2dd4bf",bg:"bg-teal-500/10 border-teal-500/30"}].map(t=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg border ${t.bg}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{shape:t.shape,glowColor:t.glowColor,size:"default"}),e.jsx("span",{className:`font-bold ${t.color}`,children:t.name})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.min,"+"]})]},t.name))]}),e.jsx("div",{className:"bg-slate-800/50 rounded-lg p-3 border border-slate-700/30",children:e.jsxs("p",{className:"text-xs text-slate-500",children:["All players start at ",e.jsx("span",{className:"text-amber-400 font-bold",children:"1000 ELO"}),". Your rating adjusts faster during your first 30 games, then stabilizes as your true skill level emerges."]})})]}),e.jsx("div",{className:"p-4 border-t border-amber-500/20",children:e.jsx("button",{onClick:()=>We(!1),className:"w-full py-2.5 rounded-lg font-bold text-white bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 transition-all",children:"Got It!"})})]})}),Oe&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-sm w-full overflow-hidden border border-amber-500/30 shadow-[0_0_50px_rgba(251,191,36,0.2)]",children:[e.jsxs("div",{className:"p-4 border-b border-amber-500/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{size:20,className:"text-amber-400"}),e.jsx("h2",{className:"text-lg font-bold text-amber-300",children:"Edit Username"})]}),e.jsx("button",{onClick:()=>J(!1),className:"p-1 text-slate-400 hover:text-white transition-colors",children:e.jsx(I,{size:24})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-2",children:"New Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:B,onChange:t=>Mt(t.target.value),placeholder:"Enter username",className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-amber-500 transition-colors",maxLength:20}),se&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(yt,{size:18,className:"text-amber-400 animate-spin"})})]}),D&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:D}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"3-20 characters. Letters, numbers, and underscores only."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>J(!1),className:"flex-1 py-3 rounded-lg font-bold text-slate-400 bg-slate-800 hover:bg-slate-700 transition-colors border border-slate-700",children:"Cancel"}),e.jsx("button",{onClick:qt,disabled:!!D||se||we||!B||B===s?.username,className:"flex-1 py-3 rounded-lg font-bold text-white bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:we?e.jsxs(e.Fragment,{children:[e.jsx(yt,{size:18,className:"animate-spin"}),"Saving..."]}):"Save"})]})]})]})}),At&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",onClick:t=>{t.target===t.currentTarget&&pe(!1)},children:e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-md w-full max-h-[80vh] flex flex-col border border-amber-500/30 shadow-[0_0_50px_rgba(251,191,36,0.2)]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-amber-500/20 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{size:24,className:"text-amber-400"}),e.jsx("h2",{className:"text-lg font-bold text-amber-300",children:"Active Games"}),L.length>0&&e.jsx("span",{className:"text-xs bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full",children:L.length})]}),e.jsx("button",{onClick:()=>pe(!1),className:"p-1 text-slate-400 hover:text-white transition-colors",children:e.jsx(I,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translateZ(0)",willChange:"scroll-position",position:"relative",isolation:"isolate"},onTouchStart:t=>{t.currentTarget.style.scrollBehavior="auto"},onTouchEnd:t=>{t.currentTarget.style.scrollBehavior="smooth"},children:e.jsx("div",{className:"p-4 space-y-3",children:L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"mx-auto text-slate-600 mb-2",size:40}),e.jsx("p",{className:"text-slate-400",children:"No active games"})]}):e.jsx("div",{className:"space-y-3",children:(()=>{const t=L.filter(n=>n?._isUnviewedResult),a=L.filter(n=>n&&!n._isUnviewedResult);return e.jsxs(e.Fragment,{children:[t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"Game Results"}),e.jsxs("span",{className:"px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded text-xs",children:[t.length," new"]})]}),t.map(n=>{const i=pt(n),o=n._isLoss;return e.jsxs("button",{onClick:()=>{c.playButtonClick(),pe(!1),h(n)},className:`w-full p-4 rounded-lg flex items-center justify-between transition-all ${o?"bg-gradient-to-r from-red-900/40 to-red-800/30 border border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.2)] animate-pulse":"bg-gradient-to-r from-green-900/40 to-emerald-900/30 border border-green-500/50 shadow-[0_0_15px_rgba(34,197,94,0.2)]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${o?"bg-red-500/30 text-red-400":"bg-green-500/30 text-green-400"}`,children:o?e.jsx(ps,{size:20}):e.jsx(Ye,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-white font-medium flex items-center gap-2",children:["vs ",i,e.jsx("span",{className:`text-xs font-bold px-1.5 py-0.5 rounded ${o?"bg-red-500/30 text-red-300":"bg-green-500/30 text-green-300"}`,children:o?"LOSS":"WIN"})]}),e.jsx("div",{className:`text-sm ${o?"text-red-300":"text-green-300"}`,children:"Tap to view final board"})]})]}),e.jsx(be,{size:20,className:o?"text-red-400":"text-green-400"})]},n.id)}),a.length>0&&e.jsx("div",{className:"border-t border-slate-700/50 my-3"})]}),a.length>0&&e.jsxs(e.Fragment,{children:[t.length>0&&e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-2",children:"Active Games"}),a.map(n=>{const i=U.isPlayerTurn(n,s?.id),o=pt(n);return e.jsxs("button",{onClick:()=>{c.playButtonClick(),pe(!1),h(n)},className:`w-full p-4 rounded-lg flex items-center justify-between transition-all ${i?"bg-gradient-to-r from-amber-600/30 to-orange-600/30 border border-amber-400/50 shadow-[0_0_15px_rgba(251,191,36,0.3)]":"bg-slate-800/60 hover:bg-slate-700/60 border border-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${i?"bg-amber-500":"bg-purple-600"}`,children:o?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-white font-medium",children:["vs ",o]}),e.jsx("div",{className:`text-sm flex items-center gap-1 ${i?"text-amber-300 font-medium":"text-slate-500"}`,children:i?e.jsx(e.Fragment,{children:"🎮 Your turn!"}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:12})," Waiting for opponent..."]})})]})]}),e.jsx(be,{size:20,className:i?"text-amber-400":"text-slate-600"})]},n.id)})]})]})})()})})})]})}),Lt&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",onClick:t=>{t.target===t.currentTarget&&he(!1)},children:e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-md w-full max-h-[80vh] flex flex-col border border-amber-500/30 shadow-[0_0_50px_rgba(251,191,36,0.2)]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-amber-500/20 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(jt,{size:24,className:"text-amber-400"}),e.jsx("h2",{className:"text-lg font-bold text-amber-300",children:"Recent Games"}),O.length>0&&e.jsx("span",{className:"text-xs bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full",children:O.length})]}),e.jsx("button",{onClick:()=>he(!1),className:"p-1 text-slate-400 hover:text-white transition-colors",children:e.jsx(I,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",style:{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y",transform:"translateZ(0)",willChange:"scroll-position",position:"relative",isolation:"isolate"},onTouchStart:t=>{t.currentTarget.style.scrollBehavior="auto"},onTouchEnd:t=>{t.currentTarget.style.scrollBehavior="smooth"},children:e.jsx("div",{className:"p-4",children:O.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(jt,{className:"mx-auto text-slate-600 mb-2",size:40}),e.jsx("p",{className:"text-slate-400",children:"No recent games"})]}):e.jsx("div",{className:"space-y-3",children:O.filter(t=>t).map(t=>{const a=ts(t),n=es(t);return e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700/30 hover:border-slate-600/50 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>{n.id&&(c.playButtonClick(),he(!1),Re(n.id),Le(n.data||null))},className:`flex items-center gap-3 text-left ${n.id?"hover:opacity-80 cursor-pointer":"cursor-default"} transition-opacity`,disabled:!n.id,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center text-slate-300 font-bold border border-slate-600/50",children:n.displayName?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-slate-200 font-medium flex items-center gap-1",children:["vs ",n.displayName,n.id&&e.jsx(be,{size:14,className:"text-slate-500"})]}),e.jsx("div",{className:"text-slate-500 text-xs",children:t.created_at?new Date(t.created_at).toLocaleDateString():"Unknown date"})]})]}),e.jsx("span",{className:`text-lg font-bold ${a.color}`,children:a.text})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[n.id&&e.jsxs("button",{onClick:async()=>{c.playButtonClick(),le(n.id);const{error:i}=await j.sendInvite(s.id,n.id);le(null),i||he(!1)},disabled:Ie===n.id,className:"flex items-center gap-2 px-3 py-1.5 bg-amber-500/20 text-amber-300 rounded-lg hover:bg-amber-500/30 transition-colors text-sm disabled:opacity-50",title:"Challenge to rematch",children:[Ie===n.id?e.jsx("div",{className:"w-4 h-4 border-2 border-amber-400 border-t-transparent rounded-full animate-spin"}):e.jsx(fe,{size:16}),"Challenge"]}),e.jsxs("button",{onClick:()=>{c.playButtonClick(),mt(t)},className:"flex items-center gap-2 px-3 py-1.5 bg-purple-500/20 text-purple-300 rounded-lg hover:bg-purple-500/30 transition-colors text-sm",title:"View final board state",children:[e.jsx(vs,{size:16}),"Final"]})]})]},t.id)})})})})]})}),Tt&&e.jsx(Es,{userId:s?.id,onInviteFriend:async t=>{le(t.id);const{error:a}=await j.sendInvite(s.id,t.id);le(null),a||(c.playSound("success"),ze(!1))},onSpectate:t=>{ze(!1),u?.(t)},onViewProfile:(t,a)=>{Re(t),Le(a||null)},onClose:()=>ze(!1)}),ot&&e.jsx(ys,{playerId:ot,playerData:Rt,currentUserId:s?.id,onInviteToGame:async t=>{const{error:a}=await j.sendInvite(s.id,t.id);a||(c.playSound("success"),Re(null),Le(null))},onClose:()=>{Re(null),Le(null)}}),Et&&e.jsx(bs,{userId:s?.id,onClose:()=>lt(!1)}),zt&&e.jsx(ws,{userId:s?.id,onSpectate:t=>{it(!1),u?.(t)},onClose:()=>it(!1)}),dt&&e.jsx(gs,{achievement:dt,onClose:()=>Ut(null)}),A&&e.jsx(js,{isOpen:!0,onClose:()=>mt(null),board:A.board,boardPieces:A.board_pieces,winner:A.winner_id===A.player1_id?"player1":A.winner_id===A.player2_id?"player2":null,player1Name:A.player1?.username||A.player1?.display_name||"Player 1",player2Name:A.player2?.username||A.player2?.display_name||"Player 2",viewerIsPlayer1:A.player1_id===s?.id}),e.jsx("style",{children:`
        @keyframes shine {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(200%); }
        }
        .group:hover .group-hover\\:animate-shine {
          animation: shine 1.5s ease-in-out;
        }
      `})]})};export{Js as default};
