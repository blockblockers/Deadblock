import{m as S,q as K,r as x,V as M,a2 as ee,j as e,A as te,N as se,W as R,z as G,X as ae,J as re,T as ne,K as le,s as f}from"./index-8HZmLUul.js";import{g as ie}from"./gameSync-C85scV0-.js";import{L as oe,V as ce,F as de}from"./ViewPlayerProfile-Ds208_10.js";import{P as xe}from"./pen--CaqYySY.js";import{C as pe}from"./calendar-UBey0MGi.js";import{T as me}from"./trending-up-D4E_By2q.js";import"./skip-forward-CzNewA36.js";import"./play-CKcjBX8x.js";import"./clock-DH6CZMwC.js";const ge=S("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),ue=S("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),he=S("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),L="https://oyeibyrednwlolmsjlwk.supabase.co",ye=async c=>{const s=localStorage.getItem("supabase_access_token");if(!s||!L)return[];try{const u=await fetch(`${L}/rest/v1/game_moves?game_id=eq.${c}&order=move_number.asc`,{headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95ZWlieXJlZG53bG9sbXNqbHdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMzMyNzQsImV4cCI6MjA4MDgwOTI3NH0.GNMI2HOyOn_YHPPgsrkinB5FipLedqo0bTN9PKRQJMY",Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});return u.ok?await u.json():[]}catch(u){return console.error("Error fetching game moves:",u),[]}},o=(c,s)=>{if(!c||!c.startsWith("#"))return`rgba(34, 211, 238, ${s})`;const u=parseInt(c.slice(1,3),16),j=parseInt(c.slice(3,5),16),y=parseInt(c.slice(5,7),16);return`rgba(${u}, ${j}, ${y}, ${s})`},_=c=>({"#f59e0b":"rgba(30, 20, 60, 0.95)","#a855f7":"rgba(20, 40, 40, 0.95)","#3b82f6":"rgba(40, 25, 20, 0.95)","#22d3ee":"rgba(40, 20, 40, 0.95)","#22c55e":"rgba(40, 20, 35, 0.95)","#38bdf8":"rgba(35, 25, 45, 0.95)","#2dd4bf":"rgba(40, 25, 50, 0.95)"})[c]||"rgba(15, 23, 42, 0.95)",ze=({onBack:c})=>{const{profile:s,updateProfile:u}=K(),[j,y]=x.useState(!1),[w,v]=x.useState(s?.username||s?.display_name||""),[O,C]=x.useState(!1),[I,T]=x.useState([]),[B,E]=x.useState([]),[p,F]=x.useState({totalGames:0,wins:0,losses:0,winRate:0,currentStreak:0,bestStreak:0}),[N,z]=x.useState(null),[r,$]=x.useState(null),[U,P]=x.useState(!1),[V,k]=x.useState([]),b=s?M(s.rating||1e3):null,n=b?.glowColor||"#22d3ee";x.useEffect(()=>{s&&(v(s.username||s.display_name||"Player"),D(),H())},[s]);const D=async()=>{if(s?.id)try{const{data:t}=await ie.getPlayerGames(s.id,50);if(t){const a=t.filter(h=>h.status==="completed"),d=a.filter(h=>h.winner_id===s.id).length,i=a.length-d;let l=0,m=0,g=0;for(const h of a)h.winner_id===s.id?(g++,m=Math.max(m,g)):(l===0&&g>0&&(l=g),g=0);g>0&&(l=g),F({totalGames:a.length,wins:d,losses:i,winRate:a.length>0?Math.round(d/a.length*100):0,currentStreak:l,bestStreak:m}),T(a.slice(0,10))}}catch(t){console.error("Error loading stats:",t)}},H=async()=>{if(s?.id)try{const{data:t}=await ee.getRatingHistory(s.id,50);t&&(console.log("[UserProfile] Loaded rating history:",t.length,"entries"),E(t))}catch(t){console.error("Error loading rating history:",t)}},J=(t,a)=>{const d=B.find(i=>i.game_id===t);if(d)return d.change;if(a&&s){const i=a.winner_id===s.id,l=s.rating||s.elo_rating||1e3;let m=1e3;a.player1_id===s.id?m=a.player2?.elo_rating||a.player2?.rating||1e3:m=a.player1?.elo_rating||a.player1?.rating||1e3;const g=32,h=1/(1+Math.pow(10,(m-l)/400));return Math.round(g*((i?1:0)-h))}return null},A=async()=>{C(!0),f.playButtonClick();const{error:t}=await u({username:w.toLowerCase(),display_name:w});t||y(!1),C(!1)},q=()=>{f.playButtonClick(),c()},X=t=>t.player1_id===s?.id?{id:t.player2_id,name:t.player2?.username||t.player2?.display_name||"Unknown",rating:t.player2?.rating||1e3,data:t.player2}:{id:t.player1_id,name:t.player1?.username||t.player1?.display_name||"Unknown",rating:t.player1?.rating||1e3,data:t.player1},W=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Y=t=>{f.playButtonClick(),z(t)},Z=async t=>{f.playButtonClick(),P(!0),$(t);try{const a=await ye(t.id);k(a)}catch(a){console.error("Error fetching moves:",a),k([])}P(!1)},Q=s?.username||s?.display_name||"Player";return e.jsxs("div",{className:"scroll-page bg-slate-950",children:[e.jsx("style",{children:`
        /* v7.9: Scrollable lists within the page */
        .scroll-list {
          overflow-y: auto;
          overflow-x: hidden;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior-y: contain;
          scrollbar-width: thin;
          scrollbar-color: rgba(100, 116, 139, 0.4) transparent;
        }
        
        .scroll-list::-webkit-scrollbar {
          width: 4px;
        }
        
        .scroll-list::-webkit-scrollbar-track {
          background: transparent;
        }
        
        .scroll-list::-webkit-scrollbar-thumb {
          background: rgba(100, 116, 139, 0.4);
          border-radius: 2px;
        }
      `}),e.jsxs("div",{className:"p-4 pb-8 max-w-md mx-auto",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsxs("button",{onClick:q,className:"absolute left-0 flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[e.jsx(te,{size:20}),e.jsx("span",{className:"text-sm",children:"Back"})]}),e.jsx(se,{text:"PROFILE",size:"medium"})]}),e.jsxs("div",{className:"backdrop-blur-md rounded-2xl p-6 mb-6",style:{background:`linear-gradient(135deg, ${_(n)} 0%, rgba(15, 23, 42, 0.95) 100%)`,border:`1px solid ${o(n,.4)}`,boxShadow:`0 0 30px ${o(n,.15)}`},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center",style:{background:_(n),border:`2px solid ${o(n,.5)}`,boxShadow:`0 0 20px ${o(n,.3)}`},children:b?e.jsx(R,{shape:b.shape,glowColor:n,size:"large"}):e.jsx(G,{size:32,className:"text-slate-400"})}),e.jsxs("div",{className:"flex-1",children:[j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:t=>v(t.target.value),className:"bg-slate-800/80 border border-slate-600 rounded-lg px-3 py-1.5 text-white text-lg w-full",autoFocus:!0,maxLength:20}),e.jsx("button",{onClick:A,disabled:O,className:"p-2 bg-green-600 hover:bg-green-500 rounded-lg transition-colors",children:e.jsx(ue,{size:16,className:"text-white"})}),e.jsx("button",{onClick:()=>{y(!1),v(s?.username||s?.display_name||"")},className:"p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors",children:e.jsx(ae,{size:16,className:"text-white"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Q}),e.jsx("button",{onClick:()=>y(!0),className:"p-1.5 text-slate-400 hover:text-white transition-colors",children:e.jsx(xe,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:n},children:b?.name||"Unranked"}),e.jsx("span",{className:"text-slate-500",children:"â€¢"}),e.jsxs("span",{className:"text-slate-400 text-sm",children:[s?.rating||1e3," ELO"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${o(n,.2)}`},children:[e.jsx(re,{size:20,style:{color:n},className:"mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:p.totalGames}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Games"})]}),e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${o(n,.2)}`},children:[e.jsx(ge,{size:20,className:"text-green-400 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[p.winRate,"%"]}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Win Rate"})]}),e.jsxs("div",{className:"rounded-lg p-4 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${o(n,.2)}`},children:[e.jsx(ne,{size:20,className:"text-amber-400 mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:p.wins}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Victories"})]})]}),(p.currentStreak>0||p.bestStreak>0)&&e.jsxs("div",{className:"flex justify-center gap-6 mt-4 pt-4",style:{borderTop:`1px solid ${o(n,.2)}`},children:[p.currentStreak>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”¥"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:p.currentStreak}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Current Streak"})]})]}),p.bestStreak>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-amber-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:p.bestStreak}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Best Streak"})]})]})]})]}),e.jsxs("div",{className:"backdrop-blur-md rounded-2xl p-4",style:{background:`linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, ${o(n,.05)} 100%)`,border:`1px solid ${o(n,.3)}`,boxShadow:`0 0 20px ${o(n,.1)}`},children:[e.jsxs("h3",{className:"font-bold text-sm mb-4 flex items-center gap-2",style:{color:n},children:[e.jsx(pe,{size:16}),"MATCH HISTORY"]}),I.length===0?e.jsx("p",{className:"text-slate-600 text-center py-8",children:"No games played yet"}):e.jsx("div",{className:"space-y-2",children:I.map(t=>{const a=t.winner_id===s?.id,d=X(t),i=M(d.rating),l=J(t.id,t);return e.jsxs("div",{className:`w-full p-3 rounded-lg transition-all ${a?"bg-green-900/20 border border-green-500/30":"bg-red-900/20 border border-red-500/30"}`,children:[e.jsxs("button",{onClick:()=>Y(d),className:"w-full flex items-center justify-between hover:opacity-80 transition-opacity",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a?"bg-green-400":"bg-red-400"}`}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{background:_(i?.glowColor||"#64748b"),border:`2px solid ${o(i?.glowColor||"#64748b",.5)}`},children:i?e.jsx(R,{shape:i.shape,glowColor:i.glowColor,size:"small"}):e.jsx(G,{size:14,className:"text-slate-400"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-slate-300 text-sm font-medium",children:["vs ",d.name]}),e.jsxs("div",{className:"text-slate-600 text-xs flex items-center gap-2",children:[e.jsx("span",{children:W(t.created_at)}),e.jsxs("span",{style:{color:i?.glowColor||"#64748b"},children:[d.rating," ELO"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l!==null&&e.jsxs("div",{className:`flex items-center gap-1 text-sm font-bold ${l>0?"text-green-400":l<0?"text-red-400":"text-slate-400"}`,children:[l>0?e.jsx(me,{size:14}):l<0?e.jsx(he,{size:14}):null,e.jsxs("span",{children:[l>0?"+":"",l]})]}),e.jsx("span",{className:`text-sm font-bold ${a?"text-green-400":"text-red-400"}`,children:a?"WIN":"LOSS"}),e.jsx("div",{className:"text-slate-600",children:"â€º"})]})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{onClick:m=>{m.stopPropagation(),Z(t)},className:"flex items-center gap-1.5 px-2.5 py-1 bg-purple-500/20 text-purple-300 rounded-lg hover:bg-purple-500/30 transition-colors text-xs",title:"View final board state",children:[e.jsx(oe,{size:14}),"Final Board"]})})]},t.id)})})]}),e.jsxs("p",{className:"text-center text-slate-600 text-xs mt-6",children:["Member since ",s?.created_at?new Date(s.created_at).toLocaleDateString():"Unknown"]})]}),N&&e.jsx(ce,{playerId:N.id,playerData:N.data,currentUserId:s?.id,onClose:()=>z(null)}),r&&e.jsx(de,{onClose:()=>{$(null),k([])},board:r.board,boardPieces:r.board_pieces,moveHistory:V,isLoadingMoves:U,winner:r.winner_id===r.player1_id?"player1":r.winner_id===r.player2_id?"player2":null,winnerId:r.winner_id,player1:r.player1,player2:r.player2,player1Name:r.player1?.username||r.player1?.display_name||"Player 1",player2Name:r.player2?.username||r.player2?.display_name||"Player 2",player1Rating:r.player1_rating_before||r.player1_rating_after||r.player1?.elo_rating||1200,player2Rating:r.player2_rating_before||r.player2_rating_after||r.player2?.elo_rating||1200,viewerIsPlayer1:r.player1_id===s?.id,gameDate:r.created_at})]})};export{ze as default};
