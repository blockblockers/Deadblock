import{m as de,$ as v,a7 as Ae,ai as C,aj as Ee,ak as we,al as Ne,am as ve,r as f,B as q,d as _e,j as e,X as Fe,W as ce,a2 as be,T as ye,L as ie,an as Me,p as je,s as k,ao as ke,I as Se,o as Ie,a3 as $e,K as Oe,ad as Le}from"./index-8HZmLUul.js";import{S as Te,P as Be,a as Ge}from"./skip-forward-CzNewA36.js";import{P as We}from"./play-CKcjBX8x.js";import{T as De}from"./trending-up-D4E_By2q.js";import{C as Ve}from"./calendar-UBey0MGi.js";import{C as Ce}from"./clock-DH6CZMwC.js";const Je=de("Film",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"2.18",ry:"2.18",key:"vury4c"}],["line",{x1:"7",x2:"7",y1:"2",y2:"22",key:"t1e4qh"}],["line",{x1:"17",x2:"17",y1:"2",y2:"22",key:"1tliql"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"2",x2:"7",y1:"7",y2:"7",key:"1wdzzh"}],["line",{x1:"2",x2:"7",y1:"17",y2:"17",key:"2fufxq"}],["line",{x1:"17",x2:"22",y1:"17",y2:"17",key:"1xg577"}],["line",{x1:"17",x2:"22",y1:"7",y2:"7",key:"acrv2l"}]]),Ye=de("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),Xe=de("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Ze=de("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);let ne=null;const ge={async getFriends(t){if(!v())return{data:[],error:null};try{const{data:s,error:a}=await C("friends",{select:"id,status,created_at,user_id,friend_id",or:`user_id.eq.${t},friend_id.eq.${t}`,eq:{status:"accepted"}});if(a||!s?.length)return{data:[],error:a};const o=[...new Set(s.flatMap(w=>[w.user_id,w.friend_id].filter(B=>B!==t)))],{data:d}=await C("profiles",{select:"id,username,avatar_url,rating,is_online,last_seen",in:{id:o}}),m={};return d?.forEach(w=>{m[w.id]=w}),{data:s.map(w=>{const B=w.user_id===t?w.friend_id:w.user_id;return{friendshipId:w.id,...m[B],friendSince:w.created_at}}),error:null}}catch(s){return console.error("Error in getFriends:",s),{data:[],error:null}}},async getPendingRequests(t){if(!v())return{data:[],error:null};try{const{data:s,error:a}=await C("friends",{select:"id,created_at,user_id",eq:{friend_id:t,status:"pending"}});if(a||!s?.length)return{data:[],error:null};const o=s.map(l=>l.user_id),{data:d}=await C("profiles",{select:"id,username,avatar_url,rating",in:{id:o}}),m={};return d?.forEach(l=>{m[l.id]=l}),{data:s.map(l=>({requestId:l.id,from:m[l.user_id],requestedAt:l.created_at})),error:null}}catch(s){return console.error("Error in getPendingRequests:",s),{data:[],error:null}}},async getSentRequests(t){if(!v())return{data:[],error:null};try{const{data:s,error:a}=await C("friends",{select:"id,created_at,friend_id",eq:{user_id:t,status:"pending"}});if(a||!s?.length)return{data:[],error:null};const o=s.map(l=>l.friend_id),{data:d}=await C("profiles",{select:"id,username,avatar_url,rating",in:{id:o}}),m={};return d?.forEach(l=>{m[l.id]=l}),{data:s.map(l=>({requestId:l.id,to:m[l.friend_id],requestedAt:l.created_at})),error:null}}catch(s){return console.error("Error in getSentRequests:",s),{data:[],error:null}}},async sendFriendRequest(t,s){if(!v())return{data:null,error:{message:"Not configured"}};const{data:a}=await C("friends",{select:"id,status",or:`and(user_id.eq.${t},friend_id.eq.${s}),and(user_id.eq.${s},friend_id.eq.${t})`,single:!0});if(a){if(a.status==="accepted")return{data:null,error:{message:"Already friends"}};if(a.status==="pending")return{data:null,error:{message:"Friend request already pending"}}}return await Ne("friends",{user_id:t,friend_id:s,status:"pending"},{returning:!0,single:!0})},async acceptFriendRequest(t,s){return v()?await we("friends",{status:"accepted",updated_at:new Date().toISOString()},{eq:{id:t,friend_id:s}},{returning:!0,single:!0}):{data:null,error:{message:"Not configured"}}},async declineFriendRequest(t,s){return v()?await ve("friends",{eq:{id:t},or:`user_id.eq.${s},friend_id.eq.${s}`}):{error:{message:"Not configured"}}},async removeFriend(t,s){return v()?await ve("friends",{eq:{id:t},or:`user_id.eq.${s},friend_id.eq.${s}`}):{error:{message:"Not configured"}}},async areFriends(t,s){if(!v())return!1;const{data:a}=await C("friends",{select:"id",or:`and(user_id.eq.${t},friend_id.eq.${s}),and(user_id.eq.${s},friend_id.eq.${t})`,eq:{status:"accepted"},single:!0});return!!a},async getFriendshipStatus(t,s){if(!v()||!t||!s)return{status:null,friendshipId:null};try{const{data:a}=await C("friends",{select:"id,user_id,friend_id,status",or:`and(user_id.eq.${t},friend_id.eq.${s}),and(user_id.eq.${s},friend_id.eq.${t})`,single:!0});return a?a.status==="accepted"?{status:"friends",friendshipId:a.id}:a.status==="blocked"?{status:"blocked",friendshipId:a.id}:a.status==="pending"?a.user_id===t?{status:"pending_sent",friendshipId:a.id}:{status:"pending_received",friendshipId:a.id}:{status:null,friendshipId:null}:{status:null,friendshipId:null}}catch(a){return console.error("Error getting friendship status:",a),{status:null,friendshipId:null}}},async blockUser(t,s){if(!v())return{error:{message:"Not configured"}};const{data:a}=await C("friends",{select:"id",or:`and(user_id.eq.${t},friend_id.eq.${s}),and(user_id.eq.${s},friend_id.eq.${t})`,single:!0});return a?await we("friends",{status:"blocked",updated_at:new Date().toISOString()},{eq:{id:a.id}}):await Ne("friends",{user_id:t,friend_id:s,status:"blocked"})},async updateOnlineStatus(t,s){v()&&await Ee("update_online_status",{user_uuid:t,online:s})},subscribToFriendStatus(t,s,a){return!v()||!s.length?null:(console.log("[FriendsService] Starting friend status polling (30s interval)"),this.fetchFriendStatuses(s).then(o=>{o.forEach(d=>a(d))}),ne=setInterval(async()=>{(await this.fetchFriendStatuses(s)).forEach(d=>a(d))},3e4),{unsubscribe:()=>{ne&&(clearInterval(ne),ne=null)}})},async fetchFriendStatuses(t){if(!v()||!t.length)return[];try{const{data:s}=await C("profiles",{select:"id,is_online,last_seen",in:{id:t}});return s||[]}catch(s){return console.error("Error fetching friend statuses:",s),[]}},subscribeToFriendRequests(t,s){return v()?(console.log("[FriendsService] Subscribing to friend requests via RealtimeManager"),{unsubscribe:Ae.on("friendRequest",o=>{console.log("[FriendsService] Friend request received:",o?.id),s(o)})}):{unsubscribe:()=>{}}}},qe=(t,s)=>{if(!t||!t.startsWith("#"))return`rgba(100, 116, 139, ${s})`;const a=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),d=parseInt(t.slice(5,7),16);return`rgba(${a}, ${o}, ${d}, ${s})`},Ke=({board:t,boardPieces:s,moveHistory:a=[],isLoadingMoves:o=!1,player1:d=null,player2:m=null,player1Name:l="Player 1",player2Name:w="Player 2",player1Rating:B=1200,player2Rating:ee=1200,winner:K=null,winnerId:Q=null,gameDate:J=null,onClose:G})=>{const[O,P]=f.useState(-1),[L,R]=f.useState(!1),[W,te]=f.useState(800),E=d?.username||d?.display_name||l,U=m?.username||m?.display_name||w,se=d?.elo_rating||d?.rating||B||1200,H=m?.elo_rating||m?.rating||ee||1200,Y=d?.id,ae=m?.id,_=K==="player1"||Q===Y,D=K==="player2"||Q===ae,y=be.getRatingTier(se),X=be.getRatingTier(H),Z=f.useMemo(()=>Array.isArray(t)&&t.length===q?t.map(c=>c.map(r=>r===0?null:r)):Array(q).fill(null).map(()=>Array(q).fill(null)),[t]),V=f.useMemo(()=>s&&typeof s=="object"?s:{},[s]),oe=f.useMemo(()=>{const c={};return!a||a.length===0||a.forEach((r,j)=>{if(!r?.piece_type||r.row===void 0||r.col===void 0)return;const h=r.rotation||0,A=r.flipped||!1;_e(r.piece_type,h,A).forEach(([I,i])=>{const p=r.row+i,b=r.col+I;p>=0&&p<q&&b>=0&&b<q&&(c[`${p},${b}`]={moveNumber:j+1,player:r.player_number||j%2+1,pieceType:r.piece_type,isLastMove:j===a.length-1})})}),c},[a]),M=f.useMemo(()=>{const c=[{board:Array(q).fill(null).map(()=>Array(q).fill(null)),pieces:{}}];if(!a||a.length===0)return c.push({board:Z,pieces:V}),c;let r=Array(q).fill(null).map(()=>Array(q).fill(null)),j={};return a.forEach((h,A)=>{if(!h?.piece_type||h.row===void 0||h.col===void 0)return;const N=h.rotation||0,I=h.flipped||!1,i=h.player_number||A%2+1,p=_e(h.piece_type,N,I);r=r.map(b=>[...b]),j={...j},p.forEach(([b,$])=>{const T=h.row+$,re=h.col+b;T>=0&&T<q&&re>=0&&re<q&&(r[T][re]=i,j[`${T},${re}`]=h.piece_type)}),c.push({board:r,pieces:j})}),c},[a,Z,V]);f.useEffect(()=>{if(!L||a.length===0)return;const c=setInterval(()=>{P(r=>r>=a.length-1?(R(!1),-1):r+1)},W);return()=>clearInterval(c)},[L,W,a.length]);const u=()=>{P(0),R(!0),k.playButtonClick?.()},xe=()=>{R(!1),k.playButtonClick?.()},ue=()=>{R(!1),k.playButtonClick?.(),P(c=>Math.max(-1,c-1))},pe=()=>{R(!1),k.playButtonClick?.(),P(c=>c<a.length-1?c+1:-1)},me=()=>{R(!1),k.playButtonClick?.(),P(0)},fe=()=>{R(!1),k.playButtonClick?.(),P(-1)},z=O===-1,he=z?M.length-1:Math.min(O+1,M.length-1),n=M[he]||{board:Z,pieces:V},x=(c,r)=>oe[`${c},${r}`],F=(c,r)=>n.pieces[`${c},${r}`],S=J?new Date(J).toLocaleDateString(void 0,{month:"short",day:"numeric"}):null;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 bg-slate-900 border-b border-purple-500/30 shrink-0",children:[e.jsx("button",{onClick:G,className:"p-1 text-slate-400 hover:text-white",children:e.jsx(Fe,{size:18})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{size:12,className:"text-purple-400"}),e.jsx("span",{className:"text-purple-400 text-xs font-medium",children:"Replay"}),S&&e.jsxs("span",{className:"text-slate-500 text-[10px]",children:["â€¢ ",S]})]}),e.jsx("div",{className:"w-6"})]}),e.jsxs("div",{className:"flex items-center justify-between px-2 py-1 bg-slate-800/50 text-[10px] shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"relative w-5 h-5 rounded flex items-center justify-center",style:{background:`linear-gradient(135deg, ${qe(y.glowColor,.3)}, transparent)`},children:[e.jsx(ce,{shape:y.shape,glowColor:y.glowColor,size:"small"}),_&&e.jsx(ye,{size:6,className:"absolute -top-0.5 -right-0.5 text-amber-400"})]}),e.jsxs("div",{children:[e.jsx("div",{className:`font-medium leading-tight ${_?"text-amber-400":"text-white"}`,children:E}),e.jsx("div",{className:"text-slate-500 text-[8px]",children:se})]})]}),e.jsx("span",{className:"text-slate-600 font-bold text-[10px]",children:"VS"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`font-medium leading-tight ${D?"text-amber-400":"text-white"}`,children:U}),e.jsx("div",{className:"text-slate-500 text-[8px]",children:H})]}),e.jsxs("div",{className:"relative w-5 h-5 rounded flex items-center justify-center",style:{background:`linear-gradient(135deg, ${qe(X.glowColor,.3)}, transparent)`},children:[e.jsx(ce,{shape:X.shape,glowColor:X.glowColor,size:"small"}),D&&e.jsx(ye,{size:6,className:"absolute -top-0.5 -right-0.5 text-amber-400"})]})]})]}),e.jsx("div",{className:"text-center py-0.5 text-[10px] bg-slate-800/30 shrink-0",children:z?e.jsxs("span",{className:"text-amber-400 font-medium",children:[_||D?`ðŸ† ${_?E:U} wins!`:"Final"," â€¢ ",a.length," moves"]}):e.jsxs("span",{className:"text-slate-300",children:["Move ",e.jsx("span",{className:"text-white font-bold",children:O+1}),"/",a.length]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-1 py-1 min-h-0 overflow-hidden",children:o?e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{size:24,className:"text-purple-400 animate-spin mx-auto mb-1"}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Loading moves..."})]}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"grid grid-cols-8 gap-[1px] rounded-lg bg-slate-800/80 border border-slate-700/50",style:{aspectRatio:"1",width:"min(95vw, calc(100vh - 180px), 400px)",maxWidth:"400px"},children:n.board.map((c,r)=>c.map((j,h)=>{const A=`${r},${h}`,N=z?x(r,h):null,I=j!==null&&j!==0,i=z&&N&&a.length>0,p=N?.isLastMove,b=N?.player||j,$=N?.pieceType||F(r,h);let T="bg-slate-700/40";return I&&$&&ke[$]?T=ke[$]:I&&(T=j===1?"bg-cyan-500":"bg-pink-500"),e.jsxs("div",{className:`relative rounded-sm ${T} transition-all duration-200`,style:{aspectRatio:"1",boxShadow:p&&z?"0 0 12px 3px rgba(251, 191, 36, 0.8), inset 0 0 8px rgba(251, 191, 36, 0.4)":I?`inset 0 0 6px ${b===1?"rgba(34, 211, 238, 0.4)":"rgba(236, 72, 153, 0.4)"}`:"none",border:p&&z?"2px solid #fbbf24":"none"},children:[i&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${b===1?"bg-cyan-300":"bg-pink-300"}`,style:{boxShadow:b===1?"0 0 4px #22d3ee":"0 0 4px #ec4899",marginBottom:"1px"}}),e.jsx("span",{className:"font-black leading-none",style:{fontSize:"clamp(8px, 2.5vw, 12px)",color:p?"#fef3c7":"#ffffff",textShadow:"0 0 3px #000, 0 1px 2px #000, 1px 0 2px #000, -1px 0 2px #000, 0 -1px 2px #000"},children:N.moveNumber})]}),p&&i&&e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-amber-500 text-slate-900 font-black rounded px-1 whitespace-nowrap shadow-lg z-10",style:{fontSize:"6px",lineHeight:"10px"},children:"FINAL"})]},A)}))}),e.jsxs("div",{className:"flex justify-center gap-3 mt-1 text-[9px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400",style:{boxShadow:"0 0 4px #22d3ee"}}),e.jsx("span",{className:"text-cyan-400 font-medium",children:E}),e.jsx("span",{className:"text-slate-500",children:"(1,3,5...)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-pink-400",style:{boxShadow:"0 0 4px #ec4899"}}),e.jsx("span",{className:"text-pink-400 font-medium",children:U}),e.jsx("span",{className:"text-slate-500",children:"(2,4,6...)"})]})]})]})}),a.length>0&&!o&&e.jsx("div",{className:"bg-slate-900 border-t border-slate-700 px-2 py-1 shrink-0",children:e.jsxs("div",{className:"max-w-xs mx-auto space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[8px] text-slate-500 w-3 font-mono text-center",children:z?"â—":O+1}),e.jsx("div",{className:"flex-1 h-1 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-200",style:{width:z?"100%":`${(O+1)/a.length*100}%`}})}),e.jsx("span",{className:"text-[8px] text-slate-500 w-3 font-mono text-center",children:a.length})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:me,className:"p-1 rounded bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 active:scale-95",children:e.jsx(Te,{size:12})}),e.jsx("button",{onClick:ue,className:"p-1 rounded bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 active:scale-95",children:e.jsx(Me,{size:12})}),e.jsx("button",{onClick:L?xe:u,className:"p-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg active:scale-95",children:L?e.jsx(Be,{size:16}):e.jsx(We,{size:16})}),e.jsx("button",{onClick:pe,className:"p-1 rounded bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 active:scale-95",children:e.jsx(je,{size:12})}),e.jsx("button",{onClick:fe,className:"p-1 rounded bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 active:scale-95",children:e.jsx(Ge,{size:12})})]}),e.jsx("div",{className:"flex items-center justify-center gap-0.5 text-[7px]",children:[{ms:1600,lbl:"0.5x"},{ms:800,lbl:"1x"},{ms:400,lbl:"2x"},{ms:200,lbl:"4x"}].map(({ms:c,lbl:r})=>e.jsx("button",{onClick:()=>te(c),className:`px-1.5 py-0.5 rounded transition-colors active:scale-95 ${W===c?"bg-purple-600 text-white":"bg-slate-800 text-slate-400 hover:text-white"}`,children:r},c))})]})}),(o||a.length===0)&&e.jsx("div",{className:"bg-slate-900 border-t border-slate-700 p-2 shrink-0",children:e.jsx("button",{onClick:G,className:"w-full max-w-xs mx-auto block py-2 bg-slate-800 text-slate-300 rounded font-medium hover:bg-slate-700 active:scale-98",children:"Close"})})]})},Qe="sb-oyeibyrednwlolmsjlwk-auth-token",Ue="https://oyeibyrednwlolmsjlwk.supabase.co",Pe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95ZWlieXJlZG53bG9sbXNqbHdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyMzMyNzQsImV4cCI6MjA4MDgwOTI3NH0.GNMI2HOyOn_YHPPgsrkinB5FipLedqo0bTN9PKRQJMY",He=()=>{try{const t=JSON.parse(localStorage.getItem(Qe)||"null");return!t?.access_token||!Pe?null:{Authorization:`Bearer ${t.access_token}`,apikey:Pe,"Content-Type":"application/json"}}catch{return null}},le=async(t,s={})=>{const a=He();if(!a)return{data:null,error:"Not authenticated"};let o=`${Ue}/rest/v1/${t}?`;s.select&&(o+=`select=${encodeURIComponent(s.select)}&`),s.eq&&Object.entries(s.eq).forEach(([d,m])=>{o+=`${encodeURIComponent(d)}=eq.${encodeURIComponent(m)}&`}),s.order&&(o+=`order=${encodeURIComponent(s.order)}&`),s.limit&&(o+=`limit=${s.limit}&`),console.log("[dbSelect] Query:",t,o);try{const d=await fetch(o,{headers:s.single?{...a,Accept:"application/vnd.pgrst.object+json"}:a});if(!d.ok){const l=await d.text();return console.error("[dbSelect] Error:",d.status,l),{data:null,error:d.statusText}}const m=await d.json();return console.log("[dbSelect] Result:",t,"count:",Array.isArray(m)?m.length:1),{data:m,error:null}}catch(d){return console.error("[dbSelect] Exception:",d),{data:null,error:d.message}}},g=(t,s)=>{if(!t||!t.startsWith("#"))return`rgba(100, 116, 139, ${s})`;const a=parseInt(t.slice(1,3),16),o=parseInt(t.slice(3,5),16),d=parseInt(t.slice(5,7),16);return`rgba(${a}, ${o}, ${d}, ${s})`},Re=t=>({"#f59e0b":"rgba(30, 20, 60, 0.95)","#a855f7":"rgba(20, 40, 40, 0.95)","#3b82f6":"rgba(40, 25, 20, 0.95)","#22d3ee":"rgba(40, 20, 40, 0.95)","#22c55e":"rgba(40, 20, 35, 0.95)","#38bdf8":"rgba(35, 25, 45, 0.95)","#2dd4bf":"rgba(40, 25, 50, 0.95)"})[t]||"rgba(15, 23, 42, 0.95)",ze=t=>be.getRatingTier(t),lt=({playerId:t,playerData:s,currentUserId:a,onInviteToGame:o,onClose:d,onViewPlayer:m})=>{const[l,w]=f.useState(s||null),[B,ee]=f.useState(!s),[K,Q]=f.useState([]),[J,G]=f.useState(null),[O,P]=f.useState(null),[L,R]=f.useState(!1),[W,te]=f.useState(!1),[E,U]=f.useState(null),[se,H]=f.useState(!1),[Y,ae]=f.useState({wins:0,totalGames:0}),[_,D]=f.useState(null),[y,X]=f.useState(null),Z=Y.totalGames>0?Y.wins:l?.games_won||0,V=Y.totalGames>0?Y.totalGames:l?.games_played||0,oe=V>0?Math.round(Z/V*100):0,M=l?ze(l.rating||1e3):null,u=M?.glowColor||"#22d3ee";f.useEffect(()=>{t&&(ae({wins:0,totalGames:0}),Q([]),D(null),xe())},[t]);const xe=async()=>{ee(!0);try{let n=s;if(!n){const{data:x}=await le("profiles",{select:"id,username,display_name,avatar_url,rating,games_won,games_played,created_at",eq:{id:t},single:!0});n=x}n&&w(n);try{console.log("[ViewPlayerProfile] Loading games for player:",t);const{data:x,error:F}=await le("games",{select:"id,player1_id,player2_id,winner_id,status,created_at",eq:{player1_id:t,status:"completed"},order:"created_at.desc",limit:100});F&&console.warn("[ViewPlayerProfile] Error fetching player1 games:",F),console.log("[ViewPlayerProfile] Games as player1:",x?.length||0);const{data:S,error:c}=await le("games",{select:"id,player1_id,player2_id,winner_id,status,created_at",eq:{player2_id:t,status:"completed"},order:"created_at.desc",limit:100});c&&console.warn("[ViewPlayerProfile] Error fetching player2 games:",c),console.log("[ViewPlayerProfile] Games as player2:",S?.length||0);const r=[...x||[],...S||[]];r.sort((i,p)=>new Date(p.created_at)-new Date(i.created_at));const j=r.filter(i=>i.winner_id===t).length;if(console.log("[ViewPlayerProfile] Calculated stats:",{playerId:t,totalGames:r.length,wins:j,sampleWinnerIds:r.slice(0,3).map(i=>({gameId:i.id,winnerId:i.winner_id}))}),ae({wins:j,totalGames:r.length}),a&&a!==t){const i=r.filter(p=>p.player1_id===a||p.player2_id===a);if(i.length>0){const p=i.filter($=>$.winner_id===a).length,b=i.filter($=>$.winner_id===t).length;D({myWins:p,theirWins:b,total:i.length}),console.log("[ViewPlayerProfile] Head-to-head:",{myWins:p,theirWins:b,total:i.length})}else D(null)}const h=r.slice(0,10),A=new Set;h.forEach(i=>{i.player1_id!==t&&A.add(i.player1_id),i.player2_id!==t&&A.add(i.player2_id)});let N={};if(A.size>0)try{for(const i of A){const{data:p}=await le("profiles",{select:"id,username,display_name,rating",eq:{id:i},single:!0});p&&(N[i]=p)}console.log("[ViewPlayerProfile] Fetched opponent profiles:",Object.keys(N).length)}catch(i){console.warn("[ViewPlayerProfile] Error fetching opponent profiles:",i)}const I=h.map(i=>{const p=i.player1_id===t,b=p?i.player2_id:i.player1_id,$=N[b]||{id:b,username:"Unknown"};return{...i,player1:p?n:N[i.player1_id],player2:p?N[i.player2_id]:n,opponent:$}});Q(I)}catch(x){console.log("Recent games not available:",x)}try{if(typeof Se?.getAchievementStats=="function"){const{data:x}=await Se.getAchievementStats(t);x&&U({unlocked_count:x.unlockedCount||0,total_achievements:x.totalAchievements||0,earned_points:x.earnedPoints||0})}}catch{console.log("Achievement stats not available")}if(a&&a!==t)try{const x=await ge.getFriendshipStatus(a,t);typeof x=="object"&&x!==null?(G(x.status),P(x.friendshipId)):(G(x),P(null))}catch{console.log("Friend status not available")}}catch(n){console.error("Error loading player data:",n)}ee(!1)},ue=async()=>{if(!(!a||L)){R(!0);try{await ge.sendFriendRequest(a,t),G("pending_sent"),k.playSound("success")}catch(n){console.error("Error sending friend request:",n)}R(!1)}},pe=async()=>{if(!(!a||!O||W)){te(!0);try{await ge.removeFriend(O,a),G(null),P(null),k.playSound("click")}catch(n){console.error("Error removing friend:",n)}te(!1)}},me=()=>{o&&l&&(k.playButtonClick(),o(l))},fe=n=>n.player1_id===t?{id:n.player2_id,name:n.player2?.username||n.player2?.display_name||"Unknown",rating:n.player2?.rating||1e3,data:n.player2}:{id:n.player1_id,name:n.player1?.username||n.player1?.display_name||"Unknown",rating:n.player1?.rating||1e3,data:n.player1},z=n=>{m&&n.id!==a&&(k.playButtonClick(),m(n.id,n.data))},he=n=>n?new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"";return B?e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl p-8 border border-cyan-500/30",children:[e.jsx(ie,{size:32,className:"animate-spin text-cyan-400 mx-auto"}),e.jsx("p",{className:"text-slate-400 mt-3",children:"Loading profile..."})]})}):l?e.jsxs("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-slate-900 rounded-xl max-w-sm w-full max-h-[85vh] overflow-hidden border shadow-lg",style:{borderColor:g(u,.4),boxShadow:`0 0 40px ${g(u,.2)}`},children:[e.jsxs("div",{className:"p-4 border-b relative",style:{borderColor:g(u,.2),background:`linear-gradient(135deg, ${Re(u)} 0%, ${g(u,.1)} 100%)`},children:[e.jsx("button",{onClick:d,className:"absolute top-3 right-3 p-1 text-slate-400 hover:text-white transition-colors z-10",children:e.jsx(Fe,{size:20})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-black tracking-widest",style:{color:u,textShadow:`0 0 30px ${g(u,.6)}, 0 0 60px ${g(u,.3)}`},children:"DEADBLOCK"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 tracking-wide",children:"PLAYER PROFILE"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold",style:{background:`linear-gradient(135deg, ${g(u,.3)}, ${g(u,.1)})`,border:`2px solid ${g(u,.5)}`,boxShadow:`0 0 20px ${g(u,.3)}`,color:u},children:(l.username||l.display_name)?.[0]?.toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:l.username||l.display_name||"Player"}),M&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ce,{shape:M.shape,glowColor:M.glowColor,size:"small"}),e.jsx("span",{className:"text-sm font-medium",style:{color:u},children:M.name}),e.jsxs("span",{className:"text-slate-500 text-sm",children:[l.rating||1e3," ELO"]})]})]})]})]}),e.jsxs("div",{className:"p-4 overflow-y-auto overscroll-contain",style:{WebkitOverflowScrolling:"touch",maxHeight:"calc(85vh - 180px)",touchAction:"pan-y"},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${g(u,.2)}`},children:[e.jsx(ye,{size:16,className:"mx-auto mb-1 text-amber-400"}),e.jsx("div",{className:"text-white font-bold",children:Z}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Wins"})]}),e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${g(u,.2)}`},children:[e.jsx(Ie,{size:16,className:"mx-auto mb-1 text-cyan-400"}),e.jsx("div",{className:"text-white font-bold",children:V}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Games"})]}),e.jsxs("div",{className:"rounded-xl p-3 text-center",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${g(u,.2)}`},children:[e.jsx(De,{size:16,className:"mx-auto mb-1 text-green-400"}),e.jsxs("div",{className:"text-white font-bold",children:[oe,"%"]}),e.jsx("div",{className:"text-slate-500 text-xs",children:"Win Rate"})]})]}),_&&_.total>0&&e.jsxs("div",{className:"rounded-xl p-3 mb-4",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:"1px solid rgba(251, 191, 36, 0.3)",boxShadow:"0 0 15px rgba(251, 191, 36, 0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{size:16,className:"text-amber-400"}),e.jsx("span",{className:"text-amber-400 text-xs font-bold uppercase tracking-wider",children:"Head-to-Head"})]}),e.jsxs("span",{className:"text-slate-400 text-xs",children:[_.total," games"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-cyan-400 font-bold text-lg",children:_.myWins}),e.jsx("div",{className:"text-slate-500 text-[10px]",children:"YOUR WINS"})]}),e.jsxs("div",{className:"text-center border-x border-slate-700/50",children:[e.jsxs("div",{className:"text-white font-bold text-lg",children:[_.total>0?Math.round(_.myWins/_.total*100):0,"%"]}),e.jsx("div",{className:"text-slate-500 text-[10px]",children:"YOUR WIN %"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-pink-400 font-bold text-lg",children:_.theirWins}),e.jsx("div",{className:"text-slate-500 text-[10px]",children:"THEIR WINS"})]})]})]}),E&&E.total_achievements>0&&e.jsxs("button",{onClick:()=>{k.playButtonClick(),H(!0)},className:"w-full rounded-xl p-3 mb-4 flex items-center justify-between hover:opacity-80 transition-opacity group",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${g(u,.2)}`},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{size:16,className:"text-amber-400"}),e.jsx("span",{className:"text-slate-400 text-xs",children:"Achievements"})]}),e.jsxs("div",{className:"text-white font-bold",children:[E.unlocked_count||0,"/",E.total_achievements||0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-amber-400 text-xs",children:[E.earned_points||0," pts"]}),e.jsx(je,{size:14,className:"text-slate-500 group-hover:text-slate-300 transition-colors"})]})]}),K.length>0&&e.jsxs("div",{className:"rounded-xl p-3",style:{backgroundColor:"rgba(15, 23, 42, 0.6)",border:`1px solid ${g(u,.2)}`},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ve,{size:14,style:{color:u}}),e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:"Recent Matches"})]}),e.jsx("div",{className:"space-y-2",children:K.slice(0,5).map(n=>{const x=n.winner_id===t,F=fe(n),S=ze(F.rating),c=F.id!==a&&m;return e.jsxs("div",{className:`w-full p-2 rounded-lg transition-all ${x?"bg-green-900/20 border border-green-500/30":"bg-red-900/20 border border-red-500/30"}`,children:[e.jsxs("button",{onClick:()=>c&&z(F),disabled:!c,className:`w-full flex items-center justify-between ${c?"hover:opacity-80 cursor-pointer":"cursor-default"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x?"bg-green-400":"bg-red-400"}`}),e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{background:Re(S?.glowColor||"#64748b"),border:`1px solid ${g(S?.glowColor||"#64748b",.5)}`},children:S?e.jsx(ce,{shape:S.shape,glowColor:S.glowColor,size:"tiny"}):e.jsx("span",{className:"text-[8px] text-slate-400",children:F.name?.[0]?.toUpperCase()||"?"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-white text-sm font-medium",children:["vs ",F.name]}),e.jsx("div",{className:"text-slate-500 text-xs",children:he(n.created_at)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold ${x?"text-green-400":"text-red-400"}`,children:x?"WIN":"LOSS"}),c&&e.jsx(je,{size:14,className:"text-slate-600"})]})]}),e.jsx("div",{className:"mt-1.5 flex justify-end",children:e.jsxs("button",{onClick:r=>{r.stopPropagation(),k.playButtonClick(),X(n)},className:"flex items-center gap-1 px-2 py-1 bg-purple-500/20 text-purple-300 rounded-md hover:bg-purple-500/30 transition-colors text-xs",title:"View final board",children:[e.jsx(Ye,{size:12}),"Final"]})})]},n.id)})})]}),l.created_at&&e.jsxs("div",{className:"mt-4 text-center text-slate-500 text-xs",children:["Member since ",new Date(l.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]})]}),a&&a!==t&&e.jsxs("div",{className:"p-4 border-t border-slate-800 space-y-2",children:[J==="friends"?e.jsx("button",{onClick:pe,disabled:W,className:"w-full py-2.5 bg-slate-800 hover:bg-red-900/50 text-slate-300 hover:text-red-300 rounded-xl font-medium flex items-center justify-center gap-2 transition-all border border-slate-700 hover:border-red-500/50",children:W?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{size:16,className:"text-green-400"}),e.jsx("span",{children:"Friends"}),e.jsx("span",{className:"text-slate-500 text-xs ml-1",children:"(tap to remove)"})]})}):J==="pending_sent"?e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 text-amber-400",children:[e.jsx(Ce,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Request Sent"})]}):J==="pending_received"?e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2 text-cyan-400",children:[e.jsx(Ce,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Pending Request"})]}):e.jsxs("button",{onClick:ue,disabled:L,className:"w-full py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-medium flex items-center justify-center gap-2 transition-all border border-slate-700",children:[L?e.jsx(ie,{size:16,className:"animate-spin"}):e.jsx(Ze,{size:16}),"Add Friend"]}),o&&e.jsxs("button",{onClick:me,className:"w-full py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 transition-all",style:{background:`linear-gradient(135deg, ${g(u,.3)}, ${g(u,.1)})`,border:`1px solid ${g(u,.4)}`,color:u},children:[e.jsx($e,{size:16}),"Challenge to Game"]})]})]}),se&&e.jsx(Le,{userId:t,onClose:()=>H(!1),viewOnly:!0,playerName:l?.username||l?.display_name||"Player"}),y&&e.jsx(Ke,{isOpen:!0,onClose:()=>X(null),board:y.board,boardPieces:y.board_pieces,winner:y.winner_id===y.player1_id?"player1":y.winner_id===y.player2_id?"player2":null,player1Name:y.player1?.username||y.player1?.display_name||"Player 1",player2Name:y.player2?.username||y.player2?.display_name||"Player 2",viewerIsPlayer1:y.player1_id===t})]}):e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 border border-red-500/30 max-w-sm w-full",children:[e.jsx("p",{className:"text-red-400 text-center mb-4",children:"Player not found"}),e.jsx("button",{onClick:d,className:"w-full py-2 bg-slate-800 text-slate-300 rounded-lg hover:bg-slate-700",children:"Close"})]})})};export{Ke as F,Ye as L,Ze as U,lt as V,ge as f};
