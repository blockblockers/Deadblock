import{q as L,u as B,r as i,j as e,A as g,T as v,y as A,z as E,s as N,E as U,M as w}from"./index-8HZmLUul.js";import{w as n}from"./weeklyChallengeService-C2IcVwpV.js";import{C as I}from"./clock-DH6CZMwC.js";const W=({challenge:d,onBack:y})=>{const{profile:o}=L(),{needsScroll:P}=B(800),[m,_]=i.useState([]),[c,x]=i.useState(null),[r,u]=i.useState(null),[k,b]=i.useState(!0),[f,h]=i.useState(!1);i.useEffect(()=>{p()},[d]);const p=async()=>{b(!0);try{const{data:s}=await n.getLeaderboard(d.id,100);if(_(s||[]),o?.id){const a=s?.findIndex(t=>t.user_id===o.id);if(a!==-1)x(a+1),u(s[a]);else{const{data:t}=await n.getUserResult(d.id);if(t){u(t);const{rank:l}=await n.getUserRank(d.id);x(l)}}}}catch(s){console.error("Error loading leaderboard:",s)}b(!1)},R=async()=>{N.playClickSound("select"),h(!0),await p(),h(!1)},j=()=>{N.playButtonClick(),y()},z=s=>s===1?e.jsx(U,{size:18,className:"text-amber-400"}):s===2?e.jsx(w,{size:18,className:"text-slate-300"}):s===3?e.jsx(w,{size:18,className:"text-amber-600"}):e.jsx("span",{className:"text-slate-500 text-sm font-bold w-5 text-center",children:s}),C=(s,a)=>a?"bg-gradient-to-r from-red-900/50 to-rose-900/50 border-red-500/50":s===1?"bg-gradient-to-r from-amber-900/40 to-yellow-900/40 border-amber-500/40":s===2?"bg-gradient-to-r from-slate-700/40 to-slate-600/40 border-slate-400/40":s===3?"bg-gradient-to-r from-amber-800/30 to-orange-900/30 border-amber-600/30":"bg-slate-800/40 border-slate-700/30",S=s=>s.first_attempt_time_ms||s.completion_time_ms,T=s=>s.username||s.display_name||"Player";return e.jsxs("div",{className:"min-h-screen bg-slate-950",style:{overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"},children:[e.jsx("div",{className:"fixed inset-0 opacity-30 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(239,68,68,0.4) 1px, transparent 1px), linear-gradient(90deg, rgba(239,68,68,0.4) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),e.jsx("div",{className:"fixed top-10 right-20 w-64 h-64 bg-red-500/30 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"fixed bottom-20 left-10 w-48 h-48 bg-rose-500/25 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative min-h-screen px-4 py-6",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:j,className:"p-2 text-slate-400 hover:text-red-300 transition-colors",children:e.jsx(g,{size:24})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:24,className:"text-red-400"}),e.jsx("h1",{className:"text-xl font-bold text-red-300",children:"Leaderboard"})]}),e.jsx("button",{onClick:R,disabled:f,className:"p-2 text-slate-400 hover:text-red-300 transition-colors disabled:opacity-50",children:e.jsx(A,{size:20,className:f?"animate-spin":""})})]}),e.jsx("div",{className:"mb-4 p-2 bg-cyan-900/30 rounded-lg border border-cyan-500/30 text-center",children:e.jsx("span",{className:"text-cyan-300 text-xs",children:"Rankings based on FIRST ATTEMPT time"})}),r&&c&&c>10&&e.jsx("div",{className:"mb-4 p-3 bg-gradient-to-r from-red-900/40 to-rose-900/40 rounded-xl border border-red-500/40",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-300 font-bold text-sm",children:["#",c]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:"Your Position"}),e.jsxs("div",{className:"text-slate-400 text-sm",children:["First: ",n.formatTime(r.first_attempt_time_ms||r.completion_time_ms),r.best_time_ms&&r.best_time_ms<(r.first_attempt_time_ms||r.completion_time_ms)&&e.jsxs("span",{className:"text-amber-400 ml-2",children:["Best: ",n.formatTime(r.best_time_ms)]})]})]})]})})}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm rounded-2xl border border-red-500/30 overflow-hidden shadow-[0_0_30px_rgba(239,68,68,0.2)]",children:[e.jsxs("div",{className:"flex items-center px-4 py-3 bg-slate-800/50 border-b border-slate-700/50 text-slate-500 text-xs uppercase tracking-wider",children:[e.jsx("div",{className:"w-12 text-center",children:"Rank"}),e.jsx("div",{className:"flex-1",children:"Player"}),e.jsxs("div",{className:"w-24 text-right flex items-center justify-end gap-1",children:[e.jsx(I,{size:12}),"1st Attempt"]})]}),k?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-red-500/30 border-t-red-500 rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"Loading leaderboard..."})]}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{size:40,className:"mx-auto text-slate-600 mb-3"}),e.jsx("p",{className:"text-slate-400",children:"No completions yet"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Be the first to complete this week's challenge!"})]}):e.jsx("div",{className:"divide-y divide-slate-800/50 max-h-[60vh] overflow-y-auto",children:m.map((s,a)=>{const t=a+1,l=s.user_id===o?.id;return e.jsxs("div",{className:`flex items-center px-4 py-3 transition-colors ${C(t,l)} border-l-2 ${l?"border-l-red-500":"border-l-transparent"}`,children:[e.jsx("div",{className:"w-12 flex items-center justify-center",children:t<=3?e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t===1?"bg-amber-500/20":t===2?"bg-slate-400/20":"bg-amber-600/20"}`,children:z(t)}):e.jsx("span",{className:"text-slate-400 font-bold",children:t})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center overflow-hidden",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx(E,{size:16,className:"text-slate-400"})}),e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:`font-medium truncate ${l?"text-red-300":"text-white"}`,children:[T(s),l&&e.jsx("span",{className:"text-red-500 text-xs ml-1",children:"(you)"})]})})]}),e.jsx("div",{className:`w-24 text-right font-mono font-bold ${t===1?"text-amber-300":t<=3?"text-slate-300":"text-slate-400"}`,children:n.formatTime(S(s))})]},s.user_id)})})]}),e.jsxs("button",{onClick:j,className:"w-full mt-4 py-3 px-4 rounded-xl font-bold text-slate-300 bg-slate-800/70 hover:bg-slate-700/70 transition-all border border-slate-600/50 flex items-center justify-center gap-2",children:[e.jsx(g,{size:18}),"BACK"]})]}),e.jsx("div",{className:"h-8"})]})]})};export{W as default};
