import{r as o,j as e,N as z,a as A,L,o as T,T as M,M as R,p as B,U as P,A as $,s as d}from"./index-8HZmLUul.js";import{F as O}from"./FloatingPieces-CkGA4VAV.js";import{w as c}from"./weeklyChallengeService-C2IcVwpV.js";import{C as u}from"./calendar-UBey0MGi.js";import{C as U}from"./clock-DH6CZMwC.js";import{P as W}from"./play-CKcjBX8x.js";const H=({onPlay:f,onLeaderboard:j,onBack:N})=>{const[r,v]=o.useState(null),[y,x]=o.useState(!0),[n,w]=o.useState(null),[m,C]=o.useState([]);o.useEffect(()=>{h()},[]);const h=async()=>{x(!0);try{const{data:s,error:t}=await c.getCurrentChallenge();if(s&&!t){v(s);const l=await c.getUserChallengeStats(s.id);l.data&&w(l.data);const a=await c.getLeaderboard(s.id,3);console.log("[WeeklyChallengeMenu] Leaderboard result:",a),a.data&&(console.log("[WeeklyChallengeMenu] Top players data:",a.data),C(a.data))}}catch(s){console.error("Error loading weekly challenge:",s)}finally{x(!1)}},k=()=>{d.playButtonClick(),f(r)},b=()=>{d.playButtonClick(),j(r)},_=()=>{d.playButtonClick(),N()},g=s=>{if(!s)return"--:--";const t=Math.floor(s/1e3),l=Math.floor(t/60),a=t%60;return`${l}:${a.toString().padStart(2,"0")}`},E=()=>{if(!r?.ends_at)return"Unknown";const l=new Date(r.ends_at)-new Date;if(l<=0)return"Ended";const a=Math.floor(l/(1e3*60*60*24)),p=Math.floor(l%(1e3*60*60*24)/(1e3*60*60));return a>0?`${a}d ${p}h remaining`:`${p}h remaining`},i={gridColor:"rgba(239,68,68,0.5)",border:"border-red-500/50"},S={overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",touchAction:"pan-y pinch-zoom",overscrollBehavior:"contain",scrollBehavior:"smooth"};return e.jsxs("div",{className:"min-h-screen bg-slate-950",style:S,children:[e.jsx("div",{className:"fixed inset-0 opacity-40 pointer-events-none",style:{backgroundImage:`linear-gradient(${i.gridColor} 1px, transparent 1px), linear-gradient(90deg, ${i.gridColor} 1px, transparent 1px)`,backgroundSize:"40px 40px"}}),e.jsx(O,{count:12,theme:"weekly",minOpacity:.2,maxOpacity:.4}),e.jsx("div",{className:"fixed top-20 left-10 w-80 h-80 bg-red-500/30 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"fixed bottom-32 right-10 w-72 h-72 bg-rose-400/25 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"fixed top-1/2 left-1/2 w-64 h-64 bg-red-600/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative min-h-screen flex flex-col items-center px-4 py-8",children:[e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(z,{size:"large"}),e.jsx(A,{text:"WEEKLY CHALLENGE",size:"default",className:"mt-2",color:"red"})]}),e.jsx("div",{className:`bg-gradient-to-br from-slate-900/95 via-red-950/30 to-slate-900/95 backdrop-blur-md rounded-2xl p-5 border ${i.border} shadow-[0_0_60px_rgba(239,68,68,0.3),inset_0_0_30px_rgba(239,68,68,0.1)]`,children:y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"w-8 h-8 animate-spin text-red-400 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"Loading challenge..."})]}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:20,className:"text-red-400"}),e.jsxs("span",{className:"text-white font-bold",children:["Week ",r.week_number]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-amber-400 text-sm",children:[e.jsx(U,{size:14}),e.jsx("span",{children:E()})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-3 mb-4 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{size:16,className:"text-red-400"}),e.jsx("span",{className:"text-red-300 font-bold text-sm",children:"OBJECTIVE"})]}),e.jsx("p",{className:"text-slate-300 text-sm",children:"Solve the puzzle as fast as you can! Your best time counts towards the leaderboard."})]}),n?.best_time&&e.jsxs("div",{className:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 rounded-lg p-3 mb-4 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{size:16,className:"text-green-400"}),e.jsx("span",{className:"text-green-300 font-bold text-sm",children:"YOUR BEST"})]}),e.jsx("span",{className:"text-white font-mono font-bold",children:g(n.best_time)})]}),n.attempts>1&&e.jsxs("p",{className:"text-green-400/70 text-xs mt-1",children:[n.attempts," attempts"]})]}),m.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-amber-400"}),e.jsx("span",{className:"text-amber-300 font-bold text-sm",children:"TOP PLAYERS"})]}),e.jsxs("button",{onClick:b,className:"text-xs text-slate-400 hover:text-white flex items-center gap-1 transition-colors",children:["View All ",e.jsx(B,{size:12})]})]}),e.jsx("div",{className:"space-y-1",children:m.slice(0,3).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-800/50 rounded px-3 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-bold text-sm ${t===0?"text-amber-400":t===1?"text-slate-300":"text-amber-600"}`,children:["#",t+1]}),e.jsx("span",{className:"text-white text-sm truncate max-w-[120px]",children:s.username||s.display_name||"Anonymous"})]}),e.jsx("span",{className:"text-cyan-300 font-mono text-sm",children:g(s.first_attempt_time_ms||s.best_time_ms)})]},s.user_id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:k,className:"w-full py-4 rounded-xl font-black text-lg text-white bg-gradient-to-r from-red-500 to-rose-600 hover:brightness-110 transition-all flex items-center justify-center gap-2 shadow-[0_0_30px_rgba(239,68,68,0.5)] border border-white/10",children:[e.jsx(W,{size:20}),n?.best_time?"PLAY AGAIN":"START CHALLENGE"]}),e.jsxs("button",{onClick:b,className:"w-full py-3 rounded-xl font-bold text-base text-slate-300 bg-slate-800/70 hover:bg-slate-700/70 transition-all flex items-center justify-center gap-2 border border-slate-600/50",children:[e.jsx(P,{size:18}),"VIEW LEADERBOARD"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(u,{size:48,className:"mx-auto text-slate-500 mb-3"}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"No Challenge Available"}),e.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"The weekly challenge couldn't be loaded. Please try again later."}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold text-sm transition-colors",children:"Retry"})]})}),e.jsxs("button",{onClick:_,className:"w-full mt-4 py-3 rounded-xl font-bold text-base text-slate-400 bg-slate-800/50 hover:bg-slate-700/50 transition-all flex items-center justify-center gap-2 border border-slate-700/50",children:[e.jsx($,{size:18}),"BACK TO MENU"]})]}),e.jsx("div",{className:"h-8 flex-shrink-0"})]})]})};export{H as default};
