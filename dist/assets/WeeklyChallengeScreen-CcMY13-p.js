import{q as Ct,u as kt,r,t as Et,d as de,B as W,b as Qe,s as z,j as e,X as Ee,T as ze,A as ue,D as zt,N as St,G as Tt,i as Rt,R as xe,v as Pt,k as _t,w as et,x as Mt,P as Lt}from"./index-8HZmLUul.js";import{w as S}from"./weeklyChallengeService-C2IcVwpV.js";import{P as Dt}from"./play-CKcjBX8x.js";import{C as At}from"./clock-DH6CZMwC.js";const Bt=({completionTime:u,firstAttemptTime:p,bestTime:T,wasFirstAttempt:_,rank:Y,onViewLeaderboard:ee,onPlayAgain:Se,onMenu:F})=>{const $=!T||u<T,te=S.formatTime;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.9)"},children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-red-950/50 to-slate-900 rounded-2xl p-6 max-w-sm w-full border border-red-500/50 shadow-[0_0_60px_rgba(239,68,68,0.4)]",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-red-500/20 flex items-center justify-center mb-3 animate-pulse",children:e.jsx(et,{size:40,className:"text-red-400"})}),e.jsx("h2",{className:"text-2xl font-black text-red-300",children:"CHALLENGE COMPLETE!"})]}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4 border border-red-500/20",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-500 text-xs uppercase mb-1",children:"This Run"}),e.jsx("div",{className:`text-xl font-black ${$?"text-amber-400":"text-white"}`,children:te(u)}),$&&e.jsx("div",{className:"text-amber-400 text-xs mt-1",children:"NEW BEST!"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-500 text-xs uppercase mb-1",children:"Best Time"}),e.jsx("div",{className:"text-xl font-black text-slate-300",children:te($?u:T)})]})]})}),_&&e.jsxs("div",{className:"bg-gradient-to-r from-amber-900/30 to-red-900/30 rounded-xl p-3 mb-4 border border-amber-500/30 text-center",children:[e.jsx("div",{className:"text-amber-300 font-bold text-sm",children:"⭐ First Attempt Recorded!"}),e.jsx("div",{className:"text-amber-500/70 text-xs mt-1",children:"Your first completion time counts for the leaderboard."})]}),Y&&e.jsxs("div",{className:"bg-gradient-to-r from-amber-900/30 to-orange-900/30 rounded-xl p-3 mb-4 border border-amber-500/30 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ze,{size:18,className:"text-amber-400"}),e.jsxs("span",{className:"text-amber-300 font-bold",children:["Current Rank: #",Y]})]}),e.jsx("div",{className:"text-amber-500/70 text-xs mt-1",children:"Based on first attempt time"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:ee,className:"w-full p-3 rounded-xl font-bold bg-gradient-to-r from-red-500 to-rose-600 text-white hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:[e.jsx(ze,{size:18}),"VIEW LEADERBOARD"]}),e.jsxs("button",{onClick:Se,className:"w-full p-3 rounded-xl font-bold bg-slate-800 text-red-300 border border-red-500/30 hover:bg-slate-700 transition-all flex items-center justify-center gap-2",children:[e.jsx(xe,{size:18}),_?"PRACTICE RUN":"TRY AGAIN"]}),e.jsxs("button",{onClick:F,className:"w-full p-3 rounded-xl font-bold bg-slate-800/50 text-slate-400 hover:text-slate-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(ue,{size:18}),"BACK TO MENU"]})]})]})})},It=({elapsedMs:u,attemptCount:p,isFirstAttempt:T,onRetry:_,onMenu:Y})=>{const ee=S.formatTime;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0,0,0,0.9)"},children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl p-6 max-w-sm w-full border border-red-500/50 shadow-[0_0_40px_rgba(239,68,68,0.3)]",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full bg-red-900/30 flex items-center justify-center mb-3",children:e.jsx(Ee,{size:40,className:"text-red-400"})}),e.jsx("h2",{className:"text-2xl font-black text-red-300",children:"BLOCKED!"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"AI found a winning move"})]}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4 border border-slate-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-500 text-xs uppercase mb-1",children:"Time (continues on retry)"}),e.jsx("div",{className:"text-2xl font-black text-white",children:ee(u)}),p>0&&e.jsxs("div",{className:"text-slate-500 text-xs mt-1",children:["Attempt #",p+1]})]})}),T&&e.jsx("div",{className:"bg-amber-900/20 rounded-xl p-3 mb-4 border border-amber-500/30 text-center",children:e.jsx("p",{className:"text-amber-400 text-sm",children:"Your first completion time counts for the leaderboard."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:_,className:"w-full p-3 rounded-xl font-bold bg-gradient-to-r from-red-500 to-rose-600 text-white hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2 shadow-[0_0_20px_rgba(239,68,68,0.4)]",children:[e.jsx(xe,{size:18}),"RETRY (TIMER CONTINUES)"]}),e.jsxs("button",{onClick:Y,className:"w-full p-3 rounded-xl font-bold bg-slate-800/50 text-slate-400 hover:text-slate-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(ue,{size:18}),"GIVE UP"]})]})]})})},Ft=({challenge:u,onMenu:p,onMainMenu:T,onLeaderboard:_})=>{const{profile:Y}=Ct(),{needsScroll:ee,isMobile:Se}=kt(650),[F,$]=r.useState(null),[te,me]=r.useState(!0),[Te,H]=r.useState(null),[v,Re]=r.useState(!1),[tt,Pe]=r.useState(!1),[st,fe]=r.useState(!1),[U,_e]=r.useState(0),[M,Me]=r.useState(0),[rt,Le]=r.useState(null),[be,De]=r.useState(null),[X,Ae]=r.useState(null),[R,Be]=r.useState(!0),[nt,Ie]=r.useState(!1),[at,lt]=r.useState(null),[ot,Oe]=r.useState(0),[x,he]=r.useState(!1),[w,ge]=r.useState(null),[ct,pe]=r.useState({x:0,y:0}),[it,Ge]=r.useState({x:0,y:0}),[dt,ve]=r.useState(!1),[we,je]=r.useState(null),j=r.useRef(null),se=r.useRef(null),y=r.useRef(null),k=r.useRef(null);r.useRef({x:0,y:0});const V=r.useRef(!1);r.useEffect(()=>()=>{document.body.style.overflow="",document.body.style.touchAction=""},[]);const{board:re,boardPieces:ut,currentPlayer:We,selectedPiece:ne,rotation:f,flipped:b,gameOver:h,winner:ye,usedPieces:K,pendingMove:i,handleCellClick:xt,confirmMove:mt,cancelMove:ft,movePendingPiece:bt,selectPiece:Z,rotatePiece:ht,flipPiece:gt,loadPuzzle:Ye,resetCurrentPuzzle:ae,setPendingMove:le}=Et(),L=r.useRef({row:0,col:0}),Ne=r.useRef({move:null,end:null,cancel:null}),Fe=r.useRef(null),Ce=r.useRef(null),q=r.useRef(!1),D=r.useRef(null),oe=r.useRef(null),$e=r.useCallback((t,s,a,n,o,c)=>{if(!n||!t)return{row:0,col:0};const l=de(t,o,c);if(!l||l.length===0)return{row:0,col:0};const m=Math.min(...l.map(([g])=>g)),I=Math.max(...l.map(([g])=>g)),E=Math.min(...l.map(([,g])=>g)),P=Math.max(...l.map(([,g])=>g)),N=I-m+1,C=P-E+1,O=(s-n.left)/n.width,d=(a-n.top)/n.height,Q=Math.floor(O*N)+m,G=Math.floor(d*C)+E;let Ke={row:0,col:0},Ze=1/0;for(const[g,qe]of l){const Je=Math.abs(g-Q)+Math.abs(qe-G);Je<Ze&&(Ze=Je,Ke={row:qe,col:g})}return Ke},[]),He=r.useCallback((t,s)=>{if(!k.current)return null;const{left:a,top:n,width:o,height:c}=k.current,l=o/W,m=c/W,E=typeof window<"u"&&window.innerWidth<640?40:20,P=t-a,N=s-E-n,C=Math.floor(P/l),O=Math.floor(N/m),d=C-L.current.col,Q=O-L.current.row,G=4;return Q>=-G&&Q<W+G&&d>=-G&&d<W+G?{row:Q,col:d}:null},[]),A=r.useCallback(()=>{const{move:t,end:s,cancel:a}=Ne.current;t&&window.removeEventListener("touchmove",t,{capture:!0}),s&&window.removeEventListener("touchend",s,{capture:!0}),a&&window.removeEventListener("touchcancel",a,{capture:!0}),Ne.current={move:null,end:null,cancel:null}},[]),ce=r.useCallback(()=>{A();const t=n=>{n.touches&&n.touches[0]&&(Fe.current?.(n.touches[0].clientX,n.touches[0].clientY),n.cancelable&&n.preventDefault())},s=()=>{Ce.current?.()},a=()=>{Ce.current?.()};Ne.current={move:t,end:s,cancel:a},window.addEventListener("touchmove",t,{passive:!1,capture:!0}),window.addEventListener("touchend",s,{capture:!0}),window.addEventListener("touchcancel",a,{capture:!0})},[A]),J=r.useCallback((t,s)=>{if(!x&&!q.current||!w&&!D.current)return;const a=w||D.current;pe({x:t,y:s});const n=He(t,s);if(n&&a){const o=de(a,f,b),c=Math.min(...o.map(([d])=>d)),l=Math.max(...o.map(([d])=>d)),m=Math.min(...o.map(([,d])=>d)),I=Math.max(...o.map(([,d])=>d)),E=Math.floor((l+c)/2),P=Math.floor((I+m)/2),N=n.row-P,C=n.col-E;oe.current={row:N,col:C},je({row:N,col:C});const O=Qe(re,N,C,o);ve(O)}else oe.current=null,je(null),ve(!1)},[x,w,f,b,re,He]),B=r.useCallback(()=>{if(!x&&!q.current)return;A();const t=w||D.current,s=oe.current||we;if(s&&t){const a=de(t,f,b);le({piece:t,row:s.row,col:s.col,coords:a})}q.current=!1,D.current=null,oe.current=null,he(!1),ge(null),ve(!1),je(null),V.current=!1,L.current={row:0,col:0},document.body.style.overflow="",document.body.style.touchAction=""},[x,w,we,f,b,A]);Fe.current=J,Ce.current=B;const ke=r.useCallback((t,s,a,n)=>{if(V.current||h||K.includes(t)||!v)return;V.current=!0,q.current=!0,D.current=t,ce();const o=$e(t,s,a,n,f,b);L.current=o,setPieceCellOffset(o),y.current&&(k.current=y.current.getBoundingClientRect());const c=n?s-(n.left+n.width/2):0,l=n?a-(n.top+n.height/2):0;ge(t),pe({x:s,y:a}),Ge({x:c,y:l}),he(!0),Z(t),le&&le(null),document.body.style.overflow="hidden",document.body.style.touchAction="none"},[h,K,v,Z,le,f,b,$e,ce]),pt=r.useCallback(t=>{if(h||K.includes(t)||!v)return{};let s=null;return{onMouseDown:l=>{l.button===0&&(s=l.currentTarget?.getBoundingClientRect()||null,y?.current&&(k.current=y.current.getBoundingClientRect()),ke(t,l.clientX,l.clientY,s))},onTouchStart:l=>{const m=l.touches?.[0];m&&(s=l.currentTarget?.getBoundingClientRect()||null,y?.current&&(k.current=y.current.getBoundingClientRect()),ke(t,m.clientX,m.clientY,s))},onTouchMove:()=>{},onTouchEnd:()=>{}}},[h,K,v,ke]),vt=r.useCallback((t,s,a,n)=>{if(V.current||h||!v||!i||i.piece!==t)return;if(V.current=!0,q.current=!0,D.current=t,ce(),y.current&&(k.current=y.current.getBoundingClientRect()),i&&k.current){const{left:l,top:m,width:I,height:E}=k.current,P=I/W,N=E/W,C=Math.floor((s-l)/P),d={row:Math.floor((a-m)/N)-i.row,col:C-i.col};L.current=d,setPieceCellOffset(d)}else L.current={row:0,col:0},setPieceCellOffset({row:0,col:0});const o=n?s-(n.left+n.width/2):0,c=n?a-(n.top+n.height/2):0;ge(t),pe({x:s,y:a}),Ge({x:o,y:c}),he(!0),Z(t),document.body.style.overflow="hidden",document.body.style.touchAction="none"},[h,v,i,Z,ce]);r.useEffect(()=>{if(!x)return;const t=a=>{J(a.clientX,a.clientY)},s=()=>{B()};return window.addEventListener("mousemove",t),window.addEventListener("mouseup",s),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",s)}},[x,J,B]),r.useEffect(()=>{if(!x)return;const t=n=>{n.touches?.[0]&&(J(n.touches[0].clientX,n.touches[0].clientY),n.cancelable&&n.preventDefault())},s=()=>B(),a=()=>B();return window.addEventListener("touchmove",t,{passive:!1}),window.addEventListener("touchend",s),window.addEventListener("touchcancel",a),()=>{window.removeEventListener("touchmove",t),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",a)}},[x,J,B]),r.useEffect(()=>()=>{A(),document.body.style.overflow="",document.body.style.touchAction=""},[A]),r.useEffect(()=>{(async()=>{if(!u||!u.id){console.error("[WeeklyChallengeScreen] No challenge provided"),H("Challenge data not available. Please go back and try again."),me(!1);return}me(!0),H(null);try{const s=S.generatePuzzleSeed(u);console.log("[WeeklyChallengeScreen] Loading puzzle with seed:",s);const a=await Mt(s,Lt.HARD);a?(console.log("[WeeklyChallengeScreen] Puzzle loaded successfully"),$(a)):(console.error("[WeeklyChallengeScreen] Puzzle generation returned null"),H("Failed to generate puzzle. Please try again."));const{data:n}=await S.getUserResult(u.id);n&&(De(n.first_attempt_time_ms),Ae(n.best_time_ms||n.completion_time_ms),Be(!1))}catch(s){console.error("Error loading weekly puzzle:",s),H("Failed to load puzzle: "+(s.message||"Unknown error"))}me(!1)})()},[u]);const ie=r.useCallback(()=>{se.current=Date.now(),j.current=setInterval(()=>{_e(M+(Date.now()-se.current))},10)},[M]),Ue=r.useCallback(()=>{j.current&&(clearInterval(j.current),j.current=null);const t=Date.now()-se.current;return M+t},[M]),Xe=r.useCallback(()=>{j.current&&(clearInterval(j.current),j.current=null);const t=Date.now()-se.current;return Me(s=>s+t),M+t},[M]),wt=r.useCallback(()=>{if(!F){console.error("[WeeklyChallengeScreen] Cannot start game - puzzle is null"),H("Puzzle not loaded. Please go back and try again.");return}console.log("[WeeklyChallengeScreen] Starting game with puzzle"),Ye(F),Re(!0),ie(),z.playClickSound("success")},[F,Ye,ie]);r.useEffect(()=>{if(v&&h)if(ye===1){const t=Ue();Le(t),Ie(R),Pe(!0),z.playPuzzleSolvedSound(),jt(t)}else ye===2&&(Xe(),fe(!0),Oe(t=>t+1),z.playGameOver())},[h,ye,v,Ue,Xe,R]);const jt=async t=>{try{const{data:s}=await S.submitResult(u.id,t,R);if(s){R&&(De(t),Be(!1)),(!X||t<X)&&Ae(t);const{rank:a}=await S.getUserRank(u.id);lt(a)}}catch(s){console.error("Error submitting result:",s)}},yt=r.useCallback(()=>{ae(),fe(!1),ie(),z.playClickSound("success")},[ae,ie]),Ve=r.useCallback(()=>{ae(),Pe(!1),fe(!1),Le(null),Ie(!1),_e(0),Me(0),Oe(0),Re(!1)},[ae]),Nt=()=>{z.playButtonClick(),_(u)};return r.useEffect(()=>()=>{j.current&&clearInterval(j.current)},[]),te?e.jsxs("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 opacity-20 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(239,68,68,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(239,68,68,0.3) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-red-500/30 border-t-red-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-red-300",children:"Loading weekly challenge..."})]})]}):Te?e.jsxs("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 opacity-20 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(239,68,68,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(239,68,68,0.3) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),e.jsxs("div",{className:"bg-slate-900 rounded-xl p-6 max-w-sm w-full border border-red-500/30 text-center",children:[e.jsx(Ee,{size:48,className:"text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-red-300 mb-2",children:"Error"}),e.jsx("p",{className:"text-slate-400 mb-4",children:Te}),e.jsx("button",{onClick:()=>{z.playButtonClick(),p()},className:"px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold transition-colors",children:"Go Back"})]})]}):v?e.jsxs("div",{className:"min-h-screen bg-slate-950",style:{overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:x?"none":"pan-y"},children:[e.jsx("div",{className:"fixed inset-0 opacity-20 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(239,68,68,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(239,68,68,0.3) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),x&&w&&e.jsx(zt,{isDragging:x,piece:w,rotation:f,flipped:b,position:ct,offset:it,isValidDrop:dt,cellOffset:pieceCellOffset}),e.jsxs("div",{className:"relative min-h-screen flex flex-col items-center px-2 py-4",children:[e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[e.jsx("div",{className:"w-16"}),e.jsxs("div",{className:"text-center flex-1 mx-2",children:[e.jsx(St,{text:"DEADBLOCK",size:"medium",color:"red"}),e.jsx("div",{className:"text-red-400/80 text-[10px] font-bold tracking-[0.3em] uppercase mt-0",children:"WEEKLY CHALLENGE"})]}),(()=>{const t=Math.floor(U/1e3);let s,a,n,o,c;return t<30?(s="#67e8f9",a="rgba(34,211,238,0.9)",n="border-cyan-500/50",o="from-slate-900/95 to-cyan-950/40",c="text-cyan-400"):t<60?(s="#86efac",a="rgba(74,222,128,0.9)",n="border-green-500/50",o="from-slate-900/95 to-green-950/40",c="text-green-400"):t<120?(s="#fde047",a="rgba(250,204,21,0.9)",n="border-yellow-500/50",o="from-slate-900/95 to-yellow-950/40",c="text-yellow-400"):t<180?(s="#fdba74",a="rgba(251,146,60,0.9)",n="border-orange-500/50",o="from-slate-900/95 to-orange-950/40",c="text-orange-400"):(s="#fca5a5",a="rgba(239,68,68,0.9)",n="border-red-500/50",o="from-slate-900/95 to-red-950/40",c="text-red-400"),e.jsxs("div",{className:`relative px-4 py-2 bg-gradient-to-br ${o} rounded-xl border ${n} overflow-hidden transition-all duration-500`,style:{boxShadow:`0 0 25px ${a.replace("0.9","0.35")}, inset 0 0 20px ${a.replace("0.9","0.15")}, 0 4px 15px rgba(0,0,0,0.4)`},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-30",style:{background:`linear-gradient(0deg, transparent 50%, ${a.replace("0.9","0.1")} 50%)`,backgroundSize:"100% 4px",animation:"scanline 8s linear infinite"}}),e.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 border-l-2 border-t-2 transition-colors duration-500",style:{borderColor:s+"99"}}),e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 border-r-2 border-t-2 transition-colors duration-500",style:{borderColor:s+"99"}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-2 h-2 border-l-2 border-b-2 transition-colors duration-500",style:{borderColor:s+"99"}}),e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 border-r-2 border-b-2 transition-colors duration-500",style:{borderColor:s+"99"}}),e.jsxs("div",{className:"relative flex items-center gap-2.5",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full blur-md animate-pulse transition-colors duration-500",style:{backgroundColor:a.replace("0.9","0.3")}}),e.jsx(At,{size:18,className:`relative ${c} transition-colors duration-500`}),U>0&&e.jsx("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_6px_rgba(74,222,128,0.8)]"})]}),e.jsxs("div",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-xl font-mono font-black tracking-tight tabular-nums transition-all duration-500",style:{color:s,textShadow:`0 0 12px ${a}, 0 0 25px ${a.replace("0.9","0.5")}, 0 0 40px ${a.replace("0.9","0.3")}`},children:Math.floor(U/6e4)}),e.jsx("span",{className:"text-xl font-mono font-black animate-pulse transition-colors duration-500",style:{color:s,textShadow:`0 0 8px ${a.replace("0.9","0.8")}`},children:":"}),e.jsx("span",{className:"text-xl font-mono font-black tracking-tight tabular-nums transition-all duration-500",style:{color:s,textShadow:`0 0 12px ${a}, 0 0 25px ${a.replace("0.9","0.5")}, 0 0 40px ${a.replace("0.9","0.3")}`},children:String(Math.floor(U%6e4/1e3)).padStart(2,"0")})]})]})]})})()]}),e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(Tt,{ref:y,board:re,boardPieces:ut,selectedPiece:ne,pendingMove:i,rotation:f,flipped:b,onCellClick:xt,currentPlayer:We,gameOver:h,gameMode:"puzzle",onPendingPieceDragStart:vt,isDragging:x,dragPreviewCell:we,draggedPiece:w,dragRotation:f,dragFlipped:b})}),i&&!x&&e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(Rt,{onMove:bt})}),e.jsxs("div",{className:"flex gap-1 justify-between mb-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>{z.playButtonClick(),(T||p)()},className:"flex-1 px-1.5 py-1.5 bg-red-600/70 hover:bg-red-500/70 text-white rounded-lg text-xs flex items-center justify-center gap-1 border border-red-400/30 shadow-[0_0_10px_rgba(239,68,68,0.4)]",children:[e.jsx(ue,{size:12}),"MENU"]}),e.jsxs("button",{onClick:ht,className:"flex-1 px-1.5 py-1.5 bg-purple-600/70 hover:bg-purple-500/70 text-white rounded-lg text-xs flex items-center justify-center gap-1 disabled:opacity-30 border border-purple-400/30 shadow-[0_0_10px_rgba(168,85,247,0.4)]",disabled:!ne&&!i,children:[e.jsx(xe,{size:12}),"ROTATE"]}),e.jsxs("button",{onClick:gt,className:"flex-1 px-1.5 py-1.5 bg-indigo-600/70 hover:bg-indigo-500/70 text-white rounded-lg text-xs flex items-center justify-center gap-1 disabled:opacity-30 border border-indigo-400/30 shadow-[0_0_10px_rgba(99,102,241,0.4)]",disabled:!ne&&!i,children:[e.jsx(Pt,{size:12}),"FLIP"]}),e.jsxs("button",{onClick:Ve,className:"flex-1 px-1.5 py-1.5 bg-red-600/70 hover:bg-red-500/70 text-white rounded-lg text-xs flex items-center justify-center gap-1 border border-red-400/30 shadow-[0_0_10px_rgba(239,68,68,0.4)]",children:[e.jsx(xe,{size:12}),"RETRY"]})]}),e.jsx(_t,{usedPieces:K,selectedPiece:ne,pendingMove:i,gameOver:h,gameMode:"puzzle",currentPlayer:We,onSelectPiece:Z,createDragHandlers:pt,isDragging:x,draggedPiece:w}),i&&e.jsxs("div",{className:"flex gap-2 justify-center mt-2",children:[e.jsxs("button",{onClick:mt,disabled:!i||!(()=>{const t=de(i.piece,f,b);return Qe(re,i.row,i.col,t)})(),className:"flex-1 max-w-32 px-3 py-2 bg-green-600/70 hover:bg-green-500/70 text-white rounded-lg text-sm flex items-center justify-center gap-1 font-bold border border-green-400/30 shadow-[0_0_15px_rgba(74,222,128,0.5)] disabled:opacity-30 disabled:shadow-none",children:[e.jsx(et,{size:14}),"CONFIRM"]}),e.jsxs("button",{onClick:ft,className:"flex-1 max-w-32 px-3 py-2 bg-red-600/70 hover:bg-red-500/70 text-white rounded-lg text-sm flex items-center justify-center gap-1 border border-red-400/30 shadow-[0_0_10px_rgba(239,68,68,0.4)]",children:[e.jsx(Ee,{size:14}),"CANCEL"]})]})]}),e.jsx("div",{className:"h-8 flex-shrink-0"})]}),tt&&e.jsx(Bt,{completionTime:rt,firstAttemptTime:be,bestTime:X,wasFirstAttempt:nt,rank:at,onViewLeaderboard:Nt,onPlayAgain:Ve,onMenu:p}),st&&e.jsx(It,{elapsedMs:U,attemptCount:ot,isFirstAttempt:R,onRetry:yt,onMenu:p})]}):e.jsxs("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 opacity-20 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(239,68,68,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(239,68,68,0.3) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),e.jsxs("div",{className:"bg-slate-900 rounded-2xl p-6 max-w-sm w-full border border-red-500/30 shadow-[0_0_40px_rgba(239,68,68,0.2)]",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ze,{size:48,className:"text-red-400 mx-auto mb-3"}),e.jsxs("h2",{className:"text-2xl font-black text-red-300",children:["WEEK ",u?.week_number||"?"]}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Weekly Challenge"})]}),(be||X)&&e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4 border border-slate-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-xs uppercase mb-1",children:"First Time"}),e.jsx("div",{className:"text-lg font-bold text-white",children:S.formatTime(be)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-500 text-xs uppercase mb-1",children:"Best Time"}),e.jsx("div",{className:"text-lg font-bold text-amber-400",children:S.formatTime(X)})]})]})}),R?e.jsx("p",{className:"text-amber-400 text-sm text-center mb-4",children:"⭐ Your first completion time counts for the leaderboard!"}):e.jsx("p",{className:"text-slate-500 text-xs text-center mb-4",children:"Practice mode - try to beat your best time!"}),e.jsxs("button",{onClick:wt,className:"w-full p-4 rounded-xl font-black text-lg bg-gradient-to-r from-red-500 to-rose-600 text-white hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2 shadow-[0_0_30px_rgba(239,68,68,0.5)]",children:[e.jsx(Dt,{size:24}),R?"START CHALLENGE":"PRACTICE RUN"]}),e.jsxs("button",{onClick:()=>{z.playButtonClick(),p()},className:"w-full mt-3 p-3 rounded-xl font-bold text-slate-400 hover:text-slate-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(ue,{size:18}),"Back"]})]})]})};export{Ft as default};
